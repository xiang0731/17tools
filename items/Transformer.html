<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>文本转换工具</title>
    <link rel="stylesheet" href="../css/theme.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            min-height: 100vh;
            padding: var(--spacing-lg);
            background-color: var(--background-primary);
            color: var(--text-primary);
            font-family: var(--font-family);
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-md);
        }

        /* 标题样式 */
        h1 {
            text-align: center;
            color: var(--text-primary);
            margin: 0 0 var(--spacing-xl) 0;
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }

        h1::before {
            content: "\f0ae";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            color: var(--primary-color);
        }

        /* 功能按钮区域 - 优化布局 */
        .function-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-xl);
        }

        .function-button {
            padding: var(--spacing-md) var(--spacing-sm);
            background-color: var(--background-primary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 13px;
            font-weight: 500;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .function-button:hover {
            background-color: var(--background-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .function-button.active {
            background-color: var(--primary-color);
            color: var(--text-inverse);
            border-color: var(--primary-color);
            box-shadow: var(--shadow-md);
        }

        /* 文本区域样式 */
        textarea {
            width: 100%;
            padding: var(--spacing-lg);
            margin: var(--spacing-md) 0;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            min-height: 200px;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            background-color: var(--background-primary);
            color: var(--text-primary);
            font-family: var(--font-mono);
            transition: all var(--transition-fast);
        }

        textarea:focus {
            outline: none;
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        textarea:disabled {
            background-color: var(--background-secondary);
            cursor: not-allowed;
            color: var(--text-tertiary);
        }

        textarea::placeholder {
            color: var(--text-tertiary);
        }

        #output {
            background-color: var(--background-tertiary);
        }

        /* 辅助输入框样式 */
        #auxiliaryInput {
            min-height: 80px;
            background-color: var(--background-secondary);
            display: none;
            /* 默认隐藏 */
        }

        /* 文本框包装器 - 用于定位行数标签 */
        .textarea-wrapper {
            position: relative;
            margin: var(--spacing-md) 0;
        }

        .textarea-wrapper textarea {
            margin: 0;
        }

        /* 行数标签样式 */
        .line-count {
            position: absolute;
            bottom: 12px;
            right: 12px;
            background-color: var(--background-tertiary);
            color: var(--text-secondary);
            padding: 4px 10px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-family: var(--font-mono);
            pointer-events: none;
            opacity: 0.85;
            border: 1px solid var(--border-color);
            z-index: 1;
        }

        /* 操作按钮区域 */
        .action-buttons {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            margin: var(--spacing-lg) 0;
            flex-wrap: wrap;
        }

        .action-button {
            padding: var(--spacing-md) var(--spacing-xl);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            min-width: 120px;
            justify-content: center;
        }

        .btn-clear {
            background-color: #ef4444;
            color: white;
        }

        .btn-clear:hover {
            background-color: #dc2626;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: var(--text-inverse);
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
        }

        .btn-secondary {
            background-color: var(--background-primary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: var(--background-hover);
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Toast 提示样式 */
        .toast {
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
        }

        @keyframes slideIn {
            from {
                transform: translate(-50%, 100%);
                opacity: 0;
            }

            to {
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        /* 响应式设计 - 简化 */
        @media (max-width: 768px) {
            body {
                padding: var(--spacing-md);
            }

            .function-buttons {
                grid-template-columns: repeat(2, 1fr);
                gap: var(--spacing-xs);
            }

            .function-button {
                padding: var(--spacing-sm);
                font-size: 13px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-button {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .function-buttons {
                grid-template-columns: repeat(1, 1fr);
            }

            .function-button {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>文本转换工具</h1>

        <div class="function-buttons">
            <button class="function-button" data-function="A">A-添加单引号和逗号</button>
            <button class="function-button" data-function="B">B-添加双引号和逗号</button>
            <button class="function-button" data-function="C">C-句首字母大写</button>
            <button class="function-button" data-function="D">D-单词首字母大写</button>
            <button class="function-button" data-function="E">E-添加__c</button>
            <button class="function-button" data-function="F">F-去除空格</button>
            <button class="function-button" data-function="G">G-转换小写</button>
            <button class="function-button" data-function="H">H-转换大写</button>
            <button class="function-button" data-function="I">I-提取首个字符</button>
            <button class="function-button" data-function="J">J-添加前缀</button>
            <button class="function-button" data-function="K">K-添加后缀</button>
            <button class="function-button" data-function="L">L-提取特定前值</button>
            <button class="function-button" data-function="M">M-提取特定后值</button>
            <button class="function-button" data-function="N">N-添加顺序前缀</button>
            <button class="function-button" data-function="O">O-添加倒序前缀</button>
            <button class="function-button" data-function="P">P-空格换行</button>
            <button class="function-button" data-function="Q">Q-合并为一行</button>
            <button class="function-button" data-function="R">R-base64加密</button>
            <button class="function-button" data-function="S">S-base64解密</button>
            <button class="function-button" data-function="T">T-顺序排序</button>
            <button class="function-button" data-function="U">U-倒序排序</button>
        </div>

        <div class="textarea-wrapper">
            <textarea id="input" placeholder="请在此输入需要转换的文本..."></textarea>
            <span class="line-count" id="inputLineCount">0 行</span>
        </div>

        <!-- 添加辅助输入框 -->
        <textarea id="auxiliaryInput" placeholder="请输入要添加的内容..."></textarea>

        <div class="action-buttons">
            <button class="action-button btn-clear" id="clearBtn">
                <i class="fas fa-eraser"></i>
                清除
            </button>
            <button class="action-button btn-primary" id="submitBtn">
                <i class="fas fa-magic"></i>
                转换
            </button>
            <button class="action-button btn-secondary" id="copyBtn">
                <i class="fas fa-copy"></i>
                复制结果
            </button>
        </div>

        <div class="textarea-wrapper">
            <textarea id="output" readonly placeholder="转换后的结果将显示在这里..."></textarea>
            <span class="line-count" id="outputLineCount">0 行</span>
        </div>
    </div>

    <script src="../js/theme.js"></script>
    <script>
        // 工具函数：显示 Toast 提示
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.style.position = 'fixed';
            toast.style.bottom = '20px';
            toast.style.left = '50%';
            toast.style.transform = 'translateX(-50%)';
            toast.style.padding = '10px 20px';
            toast.style.borderRadius = '4px';
            toast.style.color = 'white';
            toast.style.zIndex = '1000';
            toast.style.boxShadow = '0 2px 5px rgba(0,0,0,0.2)';
            toast.style.transition = 'opacity 0.3s ease';

            if (type === 'error') {
                toast.style.backgroundColor = '#ef4444';
            } else if (type === 'success') {
                toast.style.backgroundColor = '#10b981';
            } else {
                toast.style.backgroundColor = '#3b82f6';
            }

            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // 递增字母序列的函数
        function incrementLetterSequence(sequence, increment) {
            if (increment === 0) return sequence;

            let chars = sequence.split('');
            let carry = increment;

            // 从最后一个字符开始处理进位
            for (let i = chars.length - 1; i >= 0 && carry > 0; i--) {
                let charCode = chars[i].charCodeAt(0);
                let isLower = chars[i] >= 'a' && chars[i] <= 'z';
                let minCode = isLower ? 'a'.charCodeAt(0) : 'A'.charCodeAt(0);
                let maxCode = isLower ? 'z'.charCodeAt(0) : 'Z'.charCodeAt(0);

                charCode += carry;

                if (charCode > maxCode) {
                    // 超出范围，需要进位
                    let overflow = charCode - maxCode;
                    // (overflow - 1) % 26 计算当前位新的字符偏移
                    chars[i] = String.fromCharCode(minCode + (overflow - 1) % 26);
                    // 计算进位
                    carry = Math.floor((overflow - 1) / 26) + 1;
                } else {
                    chars[i] = String.fromCharCode(charCode);
                    carry = 0;
                }
            }

            // 如果还有进位，说明超出了序列长度，自动扩展
            if (carry > 0) {
                // 判断原序列的大小写倾向，默认小写
                const isUpper = sequence.length > 0 && (sequence[0] >= 'A' && sequence[0] <= 'Z');
                const padChar = isUpper ? 'A' : 'a';
                while (carry > 0) {
                    chars.unshift(padChar);
                    // 这里简化处理：通常 carry 只能是 1
                    carry--;
                }
            }

            return chars.join('');
        }

        // 递增复杂序列的函数（数字+字母组合）
        function incrementComplexSequence(sequence, increment) {
            if (increment === 0) return sequence;

            // 从右向左扫描，找到最后一个可递增的连续段
            let segments = [];
            let currentSegment = '';
            let currentType = null; // 'number' | 'lower' | 'upper'

            for (let i = 0; i < sequence.length; i++) {
                let char = sequence[i];
                let type = null;

                if (char >= '0' && char <= '9') {
                    type = 'number';
                } else if (char >= 'a' && char <= 'z') {
                    type = 'lower';
                } else if (char >= 'A' && char <= 'Z') {
                    type = 'upper';
                } else {
                    type = 'other';
                }

                if (type === currentType) {
                    currentSegment += char;
                } else {
                    if (currentSegment) {
                        segments.push({ type: currentType, value: currentSegment });
                    }
                    currentSegment = char;
                    currentType = type;
                }
            }

            // 添加最后一段
            if (currentSegment) {
                segments.push({ type: currentType, value: currentSegment });
            }

            // 从最后一个段开始处理递增
            let carry = increment;

            // 只尝试递增最后一个有效的数字或字母段
            for (let i = segments.length - 1; i >= 0 && carry > 0; i--) {
                let segment = segments[i];

                if (segment.type === 'number') {
                    // 处理数字段
                    try {
                        let bigNumber = BigInt(segment.value) + BigInt(carry);
                        segment.value = bigNumber.toString();
                        carry = 0;
                    } catch (error) {
                        // 忽略错误
                    }
                } else if (segment.type === 'lower' || segment.type === 'upper') {
                    // 处理字母段
                    let newSequence = incrementLetterSequence(segment.value, carry);
                    segment.value = newSequence;
                    carry = 0;
                }
            }

            return segments.map(segment => segment.value).join('');
        }

        // 递减复杂序列的函数
        function decrementComplexSequence(sequence, decrement) {
            if (decrement === 0) return { value: sequence, isUnderflow: false };

            let segments = [];
            let currentSegment = '';
            let currentType = null;

            for (let i = 0; i < sequence.length; i++) {
                let char = sequence[i];
                let type = (char >= '0' && char <= '9') ? 'number' :
                    (char >= 'a' && char <= 'z') ? 'lower' :
                        (char >= 'A' && char <= 'Z') ? 'upper' : 'other';

                if (type === currentType) {
                    currentSegment += char;
                } else {
                    if (currentSegment) segments.push({ type: currentType, value: currentSegment });
                    currentSegment = char;
                    currentType = type;
                }
            }
            if (currentSegment) segments.push({ type: currentType, value: currentSegment });

            let carry = decrement;
            let isUnderflow = false;
            let resultSegments = segments.map(s => ({ ...s }));

            for (let i = resultSegments.length - 1; i >= 0 && carry > 0; i--) {
                let segment = resultSegments[i];
                if (segment.type === 'number') {
                    let val = BigInt(segment.value);
                    if (val > BigInt(carry)) {
                        segment.value = (val - BigInt(carry)).toString();
                        carry = 0;
                    } else {
                        isUnderflow = true;
                        segment.value = ""; // 序号耗尽，不显示0或负数
                        carry = 0;
                    }
                } else if (segment.type === 'lower' || segment.type === 'upper') {
                    let chars = segment.value.split('');
                    let minCode = (segment.type === 'lower' ? 'a' : 'A').charCodeAt(0);

                    for (let j = chars.length - 1; j >= 0 && carry > 0; j--) {
                        let code = chars[j].charCodeAt(0);
                        let val = code - minCode;
                        if (val >= carry) {
                            chars[j] = String.fromCharCode(code - carry);
                            carry = 0;
                        } else {
                            isUnderflow = true;
                            chars[j] = ""; // 序号耗尽
                            carry = 0;
                        }
                    }
                    segment.value = chars.join('');
                }
            }

            const finalValue = resultSegments.map(s => s.value).join('');
            return {
                value: finalValue,
                isUnderflow: isUnderflow || (finalValue === "" && decrement > 0)
            };
        }

        // 转换策略对象
        const TRANSFORMERS = {
            'A': {
                name: '添加单引号和逗号',
                description: '为每一行添加单引号和逗号，例如: Item -> \'Item\',',
                needsAuxiliary: false,
                transform: (lines) => lines.map(line => `'${line}',`).join('\n'),
                example: { input: "17\nTools", auxiliary: "", output: "'17',\n'Tools'," }
            },
            'B': {
                name: '添加双引号和逗号',
                description: '为每一行添加双引号和逗号，例如: Item -> "Item",',
                needsAuxiliary: false,
                transform: (lines) => lines.map(line => `"${line}",`).join('\n'),
                example: { input: "17\nTools", auxiliary: "", output: '"17",\n"Tools",' }
            },
            'C': {
                name: '句首字母大写',
                description: '将每一行的首字母转换为大写',
                needsAuxiliary: false,
                transform: (lines) => lines.map(line => line.charAt(0).toUpperCase() + line.slice(1)).join('\n'),
                example: { input: "hello world\ngood morning", auxiliary: "", output: "Hello world\nGood morning" }
            },
            'D': {
                name: '单词首字母大写',
                description: '将每个单词的首字母转换为大写',
                needsAuxiliary: false,
                transform: (lines) => lines.map(line =>
                    line.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')
                ).join('\n'),
                example: { input: "hello world\ngood morning", auxiliary: "", output: "Hello World\nGood Morning" }
            },
            'E': {
                name: '添加__c',
                description: '在每一行末尾添加 "__c" (通常用于Salesforce字段名)',
                needsAuxiliary: false,
                transform: (lines) => lines.map(line => `${line}__c`).join('\n'),
                example: { input: "17\nTools", auxiliary: "", output: "17__c\nTools__c" }
            },
            'F': {
                name: '去除空格',
                description: '去除每一行中的所有空格',
                needsAuxiliary: false,
                transform: (lines) => lines.map(line => line.replace(/\s/g, '')).join('\n'),
                example: { input: "hello world\ngood morning", auxiliary: "", output: "helloworld\ngoodmorning" }
            },
            'G': {
                name: '转换小写',
                description: '将所有字符转换为小写',
                needsAuxiliary: false,
                transform: (lines) => lines.map(line => line.toLowerCase()).join('\n'),
                example: { input: "Hello World", auxiliary: "", output: "hello world" }
            },
            'H': {
                name: '转换大写',
                description: '将所有字符转换为大写',
                needsAuxiliary: false,
                transform: (lines) => lines.map(line => line.toUpperCase()).join('\n'),
                example: { input: "Hello World", auxiliary: "", output: "HELLO WORLD" }
            },
            'I': {
                name: '提取首个单词',
                description: '提取每一行的第一个单词（或第一列数据）',
                needsAuxiliary: false,
                transform: (lines) => lines.map(line => {
                    const match = line.match(/^([^\s\t]+)/);
                    return match ? match[1] : line;
                }).join('\n'),
                example: { input: "17 123\nTools test abc", auxiliary: "", output: "17\nTools" }
            },
            'J': {
                name: '添加前缀',
                description: '在每一行开头添加指定内容',
                needsAuxiliary: true,
                auxiliaryPlaceholder: '请输入前缀内容...',
                transform: (lines, suffix) => lines.map(line => `${suffix}${line}`).join('\n'),
                example: { input: "A\nB", auxiliary: "a.", output: "a.A\na.B" }
            },
            'K': {
                name: '添加后缀',
                description: '在每一行末尾添加指定内容',
                needsAuxiliary: true,
                auxiliaryPlaceholder: '请输入后缀内容...',
                transform: (lines, suffix) => lines.map(line => `${line}${suffix}`).join('\n'),
                example: { input: "A\nB", auxiliary: ".a", output: "A.a\nB.a" }
            },
            'L': {
                name: '提取特定前值',
                description: '提取指定字符之前的所有内容',
                needsAuxiliary: true,
                auxiliaryPlaceholder: '请输入分隔符...',
                transform: (lines, suffix) => lines.map(line => {
                    const index = line.indexOf(suffix);
                    return index !== -1 ? line.substring(0, index) : line;
                }).join('\n'),
                example: { input: "a-123\nb-456", auxiliary: "-", output: "a\nb" }
            },
            'M': {
                name: '提取特定后值',
                description: '提取指定字符之后的所有内容',
                needsAuxiliary: true,
                auxiliaryPlaceholder: '请输入分隔符...',
                transform: (lines, suffix) => lines.map(line => {
                    const index = line.lastIndexOf(suffix);
                    return index !== -1 ? line.substring(index + suffix.length) : line;
                }).join('\n'),
                example: { input: "a-123\nb-456", auxiliary: "-", output: "123\n456" }
            },
            'N': {
                name: '添加顺序前缀',
                description: '添加自动递增的前缀序列 (如 1. 2. 3. 或 A. B. C.)',
                needsAuxiliary: true,
                auxiliaryPlaceholder: '请输入起始序号 (如 "1." 或 "a.")',
                transform: (lines, suffix) => {
                    const separatorMatch = suffix.match(/^([a-zA-Z0-9]+)(.*)$/);
                    if (separatorMatch) {
                        const incrementablePart = separatorMatch[1];
                        const punctuationPart = separatorMatch[2];
                        return lines.map((line, index) => {
                            let newIncrementable = incrementComplexSequence(incrementablePart, index);
                            return `${newIncrementable}${punctuationPart}${line}`;
                        }).join('\n');
                    } else {
                        return lines.map(line => `${suffix}${line}`).join('\n');
                    }
                },
                example: { input: "苹果\n香蕉\n橙子", auxiliary: "1a.", output: "1a.苹果\n1b.香蕉\n1c.橙子" }
            },
            'O': {
                name: '添加倒序前缀',
                description: '添加自动递减的前缀序列 (如 3. 2. 1. 或 C. B. A.)',
                needsAuxiliary: true,
                auxiliaryPlaceholder: '请输入起始序号 (如 "10." 或 "c.")',
                transform: (lines, suffix) => {
                    const separatorMatch = suffix.match(/^([a-zA-Z0-9]+)(.*)$/);
                    if (separatorMatch) {
                        const incrementablePart = separatorMatch[1];
                        const punctuationPart = separatorMatch[2];
                        let hasUnderflow = false;

                        const resultLines = lines.map((line, index) => {
                            const decResult = decrementComplexSequence(incrementablePart, index);
                            if (decResult.isUnderflow) {
                                hasUnderflow = true;
                                return `[序号不足]${line}`; // 序号不足的行添加前缀
                            }
                            return `${decResult.value}${punctuationPart}${line}`;
                        });

                        if (hasUnderflow) {
                            resultLines.unshift("温馨提示：当前前缀不足以填充全部数据");
                        }
                        return resultLines.join('\n');
                    } else {
                        return lines.map(line => `${suffix}${line}`).join('\n');
                    }
                },
                example: { input: "苹果\n香蕉\n橙子", auxiliary: "10.", output: "10.苹果\n9.香蕉\n8.橙子" }
            },
            'P': {
                name: '空格换行',
                description: '将行内的空格转换为换行符',
                needsAuxiliary: false,
                transform: (lines) => lines.map(line => {
                    const trimmedLine = line.trim();
                    if (trimmedLine === '') return '';
                    return trimmedLine.split(/\s+/).join('\n');
                }).join('\n'),
                example: { input: "1 2\n3 4", auxiliary: "", output: "1\n2\n3\n4" }
            },
            'Q': {
                name: '合并为一行',
                description: '将多行文本合并为一行，可自定义分隔符',
                needsAuxiliary: true,
                auxiliaryPlaceholder: '请输入分隔符（不填则直接合并）...',
                transform: (lines, separator) => lines.join(separator),
                example: { input: "17\nTools", auxiliary: ",", output: "17,Tools" }
            },
            'R': {
                name: 'Base64加密',
                description: '将文本转换为Base64编码 (支持UTF-8)',
                needsAuxiliary: false,
                transform: (lines) => lines.map(line => {
                    try {
                        return btoa(encodeURIComponent(line).replace(/%([0-9A-F]{2})/g, (match, p1) => 
                            String.fromCharCode('0x' + p1)));
                    } catch (e) {
                        return `[加密失败: ${line}]`;
                    }
                }).join('\n'),
                example: { input: "Hello\n你好", auxiliary: "", output: "SGVsbG8=\n5L2g5aW9" }
            },
            'S': {
                name: 'Base64解密',
                description: '将Base64编码还原为文本 (支持UTF-8)',
                needsAuxiliary: false,
                transform: (lines) => lines.map(line => {
                    try {
                        const trimmed = line.trim();
                        if (!trimmed) return "";
                        return decodeURIComponent(atob(trimmed).split('').map(c => 
                            '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
                    } catch (e) {
                        return `[解密失败: ${line}]`;
                    }
                }).join('\n'),
                example: { input: "SGVsbG8=\n5L2g5aW9", auxiliary: "", output: "Hello\n你好" }
            },
            'T': {
                name: '顺序排序',
                description: '对每一行文本按字母/数字顺序进行正序排列',
                needsAuxiliary: false,
                transform: (lines) => {
                    return [...lines].sort((a, b) => a.localeCompare(b, 'zh-Hans-CN', { numeric: true })).join('\n');
                },
                example: { input: "Banana\nApple\nCherry", auxiliary: "", output: "Apple\nBanana\nCherry" }
            },
            'U': {
                name: '倒序排序',
                description: '对每一行文本按字母/数字顺序进行倒序排列',
                needsAuxiliary: false,
                transform: (lines) => {
                    return [...lines].sort((a, b) => b.localeCompare(a, 'zh-Hans-CN', { numeric: true })).join('\n');
                },
                example: { input: "Apple\nBanana\nCherry", auxiliary: "", output: "Cherry\nBanana\nApple" }
            }
        };

        let selectedFunction = '';

        // 更新 UI 状态
        function updateUIState() {
            const inputArea = document.getElementById('input');
            const outputArea = document.getElementById('output');
            const auxiliaryArea = document.getElementById('auxiliaryInput');

            if (!selectedFunction || !TRANSFORMERS[selectedFunction]) {
                auxiliaryArea.disabled = true;
                auxiliaryArea.placeholder = "请先选择上方的一个功能...";
                auxiliaryArea.style.opacity = '0.5';
                return;
            }

            const config = TRANSFORMERS[selectedFunction];
            const example = config.example;

            inputArea.placeholder = `请在此输入需要处理的文本...\n\n示例输入：\n${example.input}`;
            outputArea.placeholder = `转换结果将显示在这里...\n\n示例输出：\n${example.output}`;

            if (config.needsAuxiliary) {
                auxiliaryArea.disabled = false;
                auxiliaryArea.style.opacity = '1';
                auxiliaryArea.style.display = 'block';
                auxiliaryArea.placeholder = `${config.auxiliaryPlaceholder}\n\n示例：${example.auxiliary}`;
            } else {
                auxiliaryArea.disabled = true;
                auxiliaryArea.style.opacity = '0.5';
                auxiliaryArea.style.display = 'none';
                auxiliaryArea.value = '';
            }
        }

        // 功能按钮点击事件
        document.querySelectorAll('.function-button').forEach(button => {
            button.addEventListener('click', function () {
                document.querySelectorAll('.function-button').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                selectedFunction = this.dataset.function;
                updateUIState();
            });
        });

        // 清除按钮
        document.getElementById('clearBtn').addEventListener('click', function () {
            document.getElementById('input').value = '';
            document.getElementById('auxiliaryInput').value = '';
            document.getElementById('output').value = '';
            updateLineCount('input', 'inputLineCount');
            updateLineCount('output', 'outputLineCount');
            showToast('已清除所有内容');
        });

        // 复制按钮
        document.getElementById('copyBtn').addEventListener('click', async function () {
            const output = document.getElementById('output');
            if (!output.value) {
                showToast('没有可复制的内容', 'error');
                return;
            }
            try {
                await navigator.clipboard.writeText(output.value);
                showToast('复制成功！', 'success');
            } catch (err) {
                // 降级方案
                output.select();
                document.execCommand('copy');
                showToast('已复制 (兼容模式)', 'success');
            }
        });

        // 提交转换按钮
        document.getElementById('submitBtn').addEventListener('click', function () {
            if (!selectedFunction) {
                showToast('请先选择一个转换功能！', 'error');
                return;
            }

            const input = document.getElementById('input').value;
            if (!input) {
                showToast('请输入需要转换的文本', 'error');
                return;
            }

            const suffix = document.getElementById('auxiliaryInput').value || '';
            const lines = input.split('\n');
            const transformer = TRANSFORMERS[selectedFunction];

            try {
                const result = transformer.transform(lines, suffix);
                document.getElementById('output').value = result;
                updateLineCount('output', 'outputLineCount');
                showToast('转换成功', 'success');
            } catch (error) {
                console.error(error);
                showToast('转换过程中发生错误', 'error');
            }
        });

        // 更新行数
        function updateLineCount(textareaId, counterId) {
            const textarea = document.getElementById(textareaId);
            const counter = document.getElementById(counterId);
            const text = textarea.value;
            let lineCount = 0;
            if (text.length > 0) {
                lineCount = text.split('\n').length;
            }
            counter.textContent = lineCount + ' 行';
        }

        document.getElementById('input').addEventListener('input', () => updateLineCount('input', 'inputLineCount'));

        // 初始化
        updateUIState();
        updateLineCount('input', 'inputLineCount');
        updateLineCount('output', 'outputLineCount');
    </script>
</body>

</html>