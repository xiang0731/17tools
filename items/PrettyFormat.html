<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£ç æ ¼å¼åŒ–å·¥å…·</title>
    <link rel="stylesheet" href="../css/theme.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/2.8.8/standalone.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/2.8.8/parser-babel.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/2.8.8/parser-html.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/2.8.8/parser-postcss.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/2.8.8/parser-typescript.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/2.8.8/parser-json.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/2.8.8/parser-yaml.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/2.8.8/parser-markdown.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prettier/2.8.8/parser-graphql.js"></script>
    <!-- æ·»åŠ highlight.jsåº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/markdown.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/graphql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/ruby.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/swift.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/csharp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/shell.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/sql.min.js"></script>
    <style>
        body {
            min-height: 100vh;
            padding: var(--spacing-lg);
            background-color: var(--background-primary);
            color: var(--text-primary);
            font-family: var(--font-family);
            margin: 0;
            overflow-x: hidden;
        }

        /* æ ‡é¢˜æ ·å¼ */
        h1 {
            text-align: center;
            color: var(--text-primary);
            margin: 0 0 var(--spacing-xl) 0;
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }

        /* ä¸»å®¹å™¨æ ·å¼ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        .editor-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-xl);
            min-height: 70vh;
        }

        @media (max-width: 1024px) {
            .editor-container {
                grid-template-columns: 1fr;
                gap: var(--spacing-lg);
            }

            body {
                padding: var(--spacing-md);
            }

            .container {
                padding: var(--spacing-lg);
            }
        }

        .code-area {
            display: flex;
            flex-direction: column;
            background: var(--background-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-fast);
        }

        .code-area:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }

        .code-header {
            background: var(--background-tertiary);
            color: var(--text-primary);
            padding: var(--spacing-md) var(--spacing-lg);
            font-weight: 600;
            font-size: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .code-header i {
            color: var(--primary-color);
        }

        .language-selector {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--background-secondary);
            padding: var(--spacing-md) var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            gap: var(--spacing-md);
            flex-wrap: wrap;
            row-gap: var(--spacing-sm);
        }

        .language-controls {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            flex: 1 1 auto;
            min-width: 300px;
            flex-wrap: wrap;
            row-gap: var(--spacing-sm);
        }

        .language-label {
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 14px;
            white-space: nowrap;
        }

        /* ä»£ç ç¼–è¾‘å™¨å®¹å™¨ */
        .editor-wrapper {
            display: flex;
            flex: 1;
            min-height: 400px;
            position: relative;
            overflow: hidden;
        }

        /* è¡Œå·å®¹å™¨ */
        .line-numbers {
            width: 60px;
            background: var(--background-tertiary);
            border-right: 1px solid var(--border-color);
            padding: var(--spacing-md) 0;
            text-align: right;
            font-family: var(--font-mono);
            font-size: 14px;
            line-height: 22.4px;
            color: var(--text-tertiary);
            overflow-y: auto;
            overflow-x: hidden;
            user-select: none;
            display: flex;
            flex-direction: column;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .line-numbers::-webkit-scrollbar {
            display: none;
        }

        .line-numbers span {
            padding: 0 var(--spacing-sm);
            min-height: 22.4px;
            height: 22.4px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            box-sizing: border-box;
        }

        textarea {
            flex: 1;
            margin: 0;
            padding: var(--spacing-md);
            border: none;
            font-family: var(--font-mono);
            font-size: 14px;
            resize: none;
            overflow: auto;
            background: var(--background-primary);
            color: var(--text-primary);
            line-height: 22.4px;
            outline: none;
            transition: background-color var(--transition-fast);
        }

        textarea::placeholder {
            color: var(--text-tertiary);
            font-style: italic;
        }

        /* ä»£ç è¾“å‡ºåŒºåŸŸ */
        .code-output {
            flex: 1;
            overflow: auto;
            background: var(--background-primary);
        }

        .output-code {
            margin: 0;
            padding: var(--spacing-md);
            font-family: var(--font-mono);
            font-size: 14px;
            line-height: 22.4px;
            background: var(--background-primary);
            color: var(--text-primary);
            white-space: pre;
            overflow: visible;
        }

        .output-code code {
            font-family: var(--font-mono);
            font-size: 14px;
            line-height: 22.4px;
        }

        /* æŒ‰é’®æ ·å¼ */
        .action-buttons {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        .action-button {
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            min-width: 80px;
            justify-content: center;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .action-button:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: var(--primary-color);
            color: var(--text-inverse);
        }

        .btn-primary:hover {
            background: var(--primary-hover);
        }

        .btn-success {
            background: var(--success-color);
            color: var(--text-inverse);
        }

        .btn-success:hover {
            background: var(--accent-hover);
        }

        .btn-info {
            background: var(--primary-color);
            color: var(--text-inverse);
        }

        .btn-info:hover {
            background: var(--primary-hover);
        }

        .btn-danger {
            background: var(--error-color);
            color: var(--text-inverse);
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: var(--background-primary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--background-hover);
            border-color: var(--primary-color);
        }

        /* é€‰æ‹©å™¨æ ·å¼ */
        select {
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            background: var(--background-primary);
            color: var(--text-primary);
            font-size: 14px;
            font-family: var(--font-family);
            cursor: pointer;
            transition: all var(--transition-fast);
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right var(--spacing-sm) center;
            background-size: 16px;
            padding-right: var(--spacing-xl);
            min-width: 150px;
        }

        select:focus {
            outline: none;
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        select:hover {
            border-color: var(--primary-color);
        }

        /* è¯­è¨€æ£€æµ‹æŒ‡ç¤ºå™¨ */
        .language-indicator {
            background: var(--primary-light);
            color: var(--primary-color);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 500;
            display: none;
            align-items: center;
            gap: var(--spacing-xs);
            border: 1px solid var(--primary-color);
        }

        .language-indicator.show {
            display: flex;
        }

        .language-indicator i {
            color: var(--primary-color);
        }

        /* çŠ¶æ€æç¤º */
        .status-message {
            position: fixed;
            top: var(--spacing-lg);
            right: var(--spacing-lg);
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-md);
            font-weight: 500;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            box-shadow: var(--shadow-lg);
        }

        .status-message.show {
            transform: translateX(0);
        }

        .status-success {
            background: var(--success-color);
            color: var(--text-inverse);
        }

        .status-error {
            background: var(--error-color);
            color: var(--text-inverse);
        }

        .status-info {
            background: var(--primary-color);
            color: var(--text-inverse);
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        .processing {
            animation: pulse 1s infinite;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            color: var(--text-tertiary);
            text-align: center;
            padding: var(--spacing-xl);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: var(--spacing-md);
            color: var(--text-tertiary);
        }

        .empty-state h3 {
            margin: 0 0 var(--spacing-sm) 0;
            color: var(--text-secondary);
        }

        .empty-state p {
            margin: 0;
            font-size: 14px;
        }

        /* é«˜äº®æ ·å¼è¦†ç›– */
        .hljs {
            background: var(--background-primary) !important;
            color: var(--text-primary) !important;
            padding: 0 !important;
        }

        pre,
        code {
            background: var(--background-primary) !important;
            color: var(--text-primary) !important;
        }

        /* å“åº”å¼è°ƒæ•´ - ä¸­ç­‰å±å¹• */
        @media (max-width: 900px) {
            .language-selector {
                flex-direction: column;
                align-items: stretch;
                gap: var(--spacing-sm);
            }

            .language-controls {
                min-width: auto;
                width: 100%;
                justify-content: flex-start;
            }

            .action-buttons {
                width: 100%;
                justify-content: flex-start;
            }
        }

        /* å“åº”å¼è°ƒæ•´ - å°å±å¹• */
        @media (max-width: 768px) {
            .language-controls {
                flex-direction: column;
                align-items: stretch;
                gap: var(--spacing-sm);
            }

            .action-buttons {
                justify-content: center;
            }

            .action-button {
                flex: 1;
                min-width: auto;
            }

            h1 {
                font-size: 24px;
            }

            .line-numbers {
                width: 50px;
            }
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <h1>
        <i class="fas fa-code"></i>
        ä»£ç æ ¼å¼åŒ–å·¥å…·
    </h1>

    <div class="container">
        <div class="editor-container">
            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="code-area">
                <div class="code-header">
                    <i class="fas fa-edit"></i>
                    ä»£ç è¾“å…¥
                </div>
                <div class="language-selector">
                    <div class="language-controls">
                        <label class="language-label" for="language">
                            <i class="fas fa-cog"></i>
                            è¯­è¨€:
                        </label>
                        <select id="language">
                            <option value="auto" selected>ğŸ¤– è‡ªåŠ¨æ£€æµ‹</option>
                            <option value="babel">ğŸ“„ JavaScript</option>
                            <option value="typescript">ğŸ“˜ TypeScript</option>
                            <option value="html">ğŸŒ HTML</option>
                            <option value="css">ğŸ¨ CSS</option>
                            <option value="json">ğŸ“‹ JSON</option>
                            <option value="yaml">ğŸ“Š YAML</option>
                            <option value="markdown">ğŸ“ Markdown</option>
                            <option value="graphql">ğŸ”— GraphQL</option>
                            <option value="cpp-highlight">âš¡ C/C++</option>
                            <option value="csharp-highlight">ğŸ”· C#</option>
                            <option value="java-highlight">â˜• Java</option>
                            <option value="python-highlight">ğŸ Python</option>
                            <option value="go-highlight">ğŸš€ Go</option>
                            <option value="rust-highlight">ğŸ¦€ Rust</option>
                            <option value="swift-highlight">ğŸ Swift</option>
                            <option value="php-highlight">ğŸ˜ PHP</option>
                            <option value="ruby-highlight">ğŸ’ Ruby</option>
                            <option value="shell-highlight">ğŸ’» Shell/Bash</option>
                            <option value="sql-highlight">ğŸ—ƒï¸ SQL</option>
                        </select>
                        <div id="detected-language" class="language-indicator">
                            <i class="fas fa-check-circle"></i>
                            <span id="language-name">JavaScript</span>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button id="clear-btn" class="action-button btn-danger" title="æ¸…ç©ºå†…å®¹">
                            <i class="fas fa-trash"></i>
                            æ¸…ç©º
                        </button>
                        <button id="copy-input-btn" class="action-button btn-secondary" title="å¤åˆ¶å†…å®¹">
                            <i class="fas fa-copy"></i>
                            å¤åˆ¶
                        </button>
                        <button id="download-input-btn" class="action-button btn-secondary" title="ä¸‹è½½æ–‡ä»¶">
                            <i class="fas fa-download"></i>
                            ä¸‹è½½
                        </button>
                    </div>
                </div>
                <div class="editor-wrapper">
                    <div id="input-line-numbers" class="line-numbers"></div>
                    <textarea id="input-code" placeholder="ğŸš€ åœ¨æ­¤ç²˜è´´æˆ–è¾“å…¥æ‚¨çš„ä»£ç ...

ğŸ’¡ æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€
ğŸ“ è‡ªåŠ¨æ£€æµ‹è¯­è¨€ç±»å‹
âœ¨ æ™ºèƒ½æ ¼å¼åŒ–ç¾åŒ–
ğŸ¯ è¯­æ³•é«˜äº®æ˜¾ç¤º"></textarea>
                </div>
            </div>

            <!-- è¾“å‡ºåŒºåŸŸ -->
            <div class="code-area">
                <div class="code-header">
                    <i class="fas fa-magic"></i>
                    æ ¼å¼åŒ–ç»“æœ
                </div>
                <div class="language-selector">
                    <div class="language-controls">
                        <button id="format-btn" class="action-button btn-primary" style="min-width: 120px;">
                            <i class="fas fa-magic"></i>
                            æ ¼å¼åŒ–ä»£ç 
                        </button>
                    </div>
                    <div class="action-buttons">
                        <button id="copy-btn" class="action-button btn-secondary" title="å¤åˆ¶ç»“æœ">
                            <i class="fas fa-copy"></i>
                            å¤åˆ¶
                        </button>
                        <button id="download-btn" class="action-button btn-secondary" title="ä¸‹è½½ç»“æœ">
                            <i class="fas fa-download"></i>
                            ä¸‹è½½
                        </button>
                    </div>
                </div>
                <div class="editor-wrapper">
                    <div id="output-line-numbers" class="line-numbers" style="display: none;"></div>
                    <div class="code-output">
                        <div class="empty-state" id="empty-state">
                            <i class="fas fa-code"></i>
                            <h3>ç­‰å¾…æ ¼å¼åŒ–</h3>
                            <p>è¾“å…¥ä»£ç åç‚¹å‡»"æ ¼å¼åŒ–ä»£ç "æŒ‰é’®</p>
                        </div>
                        <pre id="output-code" class="output-code" style="display: none;"><code></code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- çŠ¶æ€æ¶ˆæ¯å®¹å™¨ -->
    <div id="status-message" class="status-message"></div>

    <script src="../js/theme.js"></script>
    <script>
        // é˜²æŠ–åŠ¨å‡½æ•°
        function debounce(func, wait) {
            let timeout;
            return function (...args) {
                const context = this;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), wait);
            };
        }

        // çŠ¶æ€æç¤ºåŠŸèƒ½
        function showStatus(message, type = 'info', duration = 3000) {
            const statusEl = document.getElementById('status-message');
            statusEl.className = `status-message status-${type}`;

            const iconMap = {
                'success': 'fas fa-check-circle',
                'error': 'fas fa-exclamation-circle',
                'info': 'fas fa-info-circle'
            };

            statusEl.innerHTML = `<i class="${iconMap[type]}"></i> ${message}`;
            statusEl.classList.add('show');

            setTimeout(() => {
                statusEl.classList.remove('show');
            }, duration);
        }

        // è¯­è¨€æ˜ å°„
        const languageMap = {
            'babel': 'JavaScript',
            'typescript': 'TypeScript',
            'html': 'HTML',
            'css': 'CSS',
            'json': 'JSON',
            'yaml': 'YAML',
            'markdown': 'Markdown',
            'graphql': 'GraphQL',
            'php-highlight': 'PHP',
            'python-highlight': 'Python',
            'java-highlight': 'Java',
            'ruby-highlight': 'Ruby',
            'go-highlight': 'Go',
            'swift-highlight': 'Swift',
            'csharp-highlight': 'C#',
            'cpp-highlight': 'C/C++',
            'rust-highlight': 'Rust',
            'shell-highlight': 'Shell/Bash',
            'sql-highlight': 'SQL',
            'auto': 'è‡ªåŠ¨æ£€æµ‹'
        };

        // highlight.jsè¯­è¨€æ˜ å°„
        const highlightLangMap = {
            'babel': 'javascript',
            'typescript': 'typescript',
            'html': 'xml',
            'css': 'css',
            'json': 'json',
            'yaml': 'yaml',
            'markdown': 'markdown',
            'graphql': 'graphql',
            'php-highlight': 'php',
            'python-highlight': 'python',
            'java-highlight': 'java',
            'ruby-highlight': 'ruby',
            'go-highlight': 'go',
            'swift-highlight': 'swift',
            'csharp-highlight': 'csharp',
            'cpp-highlight': 'cpp',
            'rust-highlight': 'rust',
            'shell-highlight': 'shell',
            'sql-highlight': 'sql'
        };

        // æ–‡ä»¶æ‰©å±•åæ˜ å°„
        const fileExtMap = {
            'babel': 'js',
            'typescript': 'ts',
            'html': 'html',
            'css': 'css',
            'json': 'json',
            'yaml': 'yaml',
            'markdown': 'md',
            'graphql': 'graphql',
            'php-highlight': 'php',
            'python-highlight': 'py',
            'java-highlight': 'java',
            'ruby-highlight': 'rb',
            'go-highlight': 'go',
            'swift-highlight': 'swift',
            'csharp-highlight': 'cs',
            'cpp-highlight': 'cpp',
            'rust-highlight': 'rs',
            'shell-highlight': 'sh',
            'sql-highlight': 'sql'
        };

        let lastDetectedLanguage = '';
        let isFormatting = false;

        // äº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('DOMContentLoaded', function () {
            const inputCode = document.getElementById('input-code');
            const languageSelect = document.getElementById('language');
            const formatBtn = document.getElementById('format-btn');
            const copyBtn = document.getElementById('copy-btn');
            const copyInputBtn = document.getElementById('copy-input-btn');
            const downloadBtn = document.getElementById('download-btn');
            const downloadInputBtn = document.getElementById('download-input-btn');
            const clearBtn = document.getElementById('clear-btn');

            // ç»‘å®šäº‹ä»¶
            formatBtn.addEventListener('click', formatCode);
            copyBtn.addEventListener('click', copyCode);
            copyInputBtn.addEventListener('click', copyInputCode);
            downloadBtn.addEventListener('click', downloadCode);
            downloadInputBtn.addEventListener('click', downloadInputCode);
            clearBtn.addEventListener('click', clearCode);

            // è¾“å…¥äº‹ä»¶ç›‘å¬å™¨
            inputCode.addEventListener('paste', handleInputChange);
            inputCode.addEventListener('input', debounce(handleInputChange, 300));
            inputCode.addEventListener('scroll', syncInputScroll);
            inputCode.addEventListener('input', updateInputLineNumbers);

            // è¯­è¨€é€‰æ‹©å˜åŒ–
            languageSelect.addEventListener('change', () => {
                const code = inputCode.value.trim();
                if (code) {
                    formatCode();
                }
                // éšè—æ£€æµ‹æ ‡ç­¾ï¼Œé™¤éæ˜¯è‡ªåŠ¨æ£€æµ‹
                const detectedLanguageEl = document.getElementById('detected-language');
                if (languageSelect.value !== 'auto') {
                    detectedLanguageEl.classList.remove('show');
                }
            });

            // åˆå§‹åŒ–
            updateInputLineNumbers();
            inputCode.focus();

            // åŒæ­¥è¾“å…¥åŒºåŸŸæ»šåŠ¨
            function syncInputScroll() {
                document.getElementById('input-line-numbers').scrollTop = inputCode.scrollTop;
            }

            // æ›´æ–°è¾“å…¥åŒºè¡Œå·
            function updateInputLineNumbers() {
                const lineCount = inputCode.value.split('\n').length;
                let lineNumbers = '';
                for (let i = 1; i <= lineCount; i++) {
                    lineNumbers += `<span>${i}</span>`;
                }
                document.getElementById('input-line-numbers').innerHTML = lineNumbers;
            }

            // æ£€æµ‹è¯­è¨€
            function detectLanguage() {
                const code = inputCode.value.trim();
                if (!code || languageSelect.value !== 'auto') return;

                let detectedLanguage = 'babel'; // é»˜è®¤ä¸ºJavaScript

                // ç®€åŒ–çš„è¯­è¨€æ£€æµ‹é€»è¾‘
                if ((code.startsWith('{') && code.endsWith('}')) || (code.startsWith('[') && code.endsWith(']'))) {
                    try {
                        JSON.parse(code);
                        detectedLanguage = 'json';
                    } catch (e) {
                        // ä¸æ˜¯æœ‰æ•ˆçš„JSON
                    }
                } else if (code.includes('<!DOCTYPE html>') || code.match(/<html.*>/i)) {
                    detectedLanguage = 'html';
                } else if (code.match(/[\w-]+\s*:\s*[^;]+;/) && code.includes('{') && !code.includes('function')) {
                    detectedLanguage = 'css';
                } else if (code.includes(':') && (code.includes('interface ') || code.includes('type ') || code.match(/:\s*(string|number|boolean|any)\b/))) {
                    detectedLanguage = 'typescript';
                } else if (code.includes('def ') && code.includes('print(')) {
                    detectedLanguage = 'python-highlight';
                } else if (code.includes('<?php')) {
                    detectedLanguage = 'php-highlight';
                }

                // æ›´æ–°æ˜¾ç¤º
                if (detectedLanguage !== lastDetectedLanguage) {
                    lastDetectedLanguage = detectedLanguage;
                    const detectedLanguageEl = document.getElementById('detected-language');
                    const languageNameEl = document.getElementById('language-name');

                    languageNameEl.textContent = languageMap[detectedLanguage];
                    detectedLanguageEl.classList.add('show');

                    setTimeout(() => {
                        if (languageSelect.value === 'auto') {
                            formatCode();
                        }
                    }, 100);
                }
            }

            function handleInputChange() {
                const code = inputCode.value.trim();
                updateInputLineNumbers();

                if (!code) {
                    // æ¸…ç©ºè¾“å‡º
                    document.getElementById('empty-state').style.display = 'flex';
                    document.getElementById('output-line-numbers').style.display = 'none';
                    document.getElementById('output-code').style.display = 'none';
                    return;
                }

                if (languageSelect.value === 'auto') {
                    detectLanguage();
                }
            }
        });

        // æ ¼å¼åŒ–ä»£ç ä¸»å‡½æ•°
        async function formatCode() {
            if (isFormatting) return;

            const inputElement = document.getElementById('input-code');
            const code = inputElement.value.trim();

            if (!code) {
                showStatus('è¯·è¾“å…¥è¦æ ¼å¼åŒ–çš„ä»£ç ', 'error');
                return;
            }

            isFormatting = true;
            const formatBtn = document.getElementById('format-btn');
            const originalText = formatBtn.innerHTML;
            formatBtn.innerHTML = '<span class="loading"></span> æ ¼å¼åŒ–ä¸­...';
            formatBtn.disabled = true;

            try {
                const selectedLanguage = document.getElementById('language').value;
                const language = selectedLanguage === 'auto' ? lastDetectedLanguage || 'babel' : selectedLanguage;

                let formattedCode = '';

                // æ ¹æ®è¯­è¨€ç±»å‹è¿›è¡Œæ ¼å¼åŒ–
                switch (language) {
                    case 'babel':
                    case 'typescript':
                        try {
                            formattedCode = prettier.format(code, {
                                parser: language === 'typescript' ? 'typescript' : 'babel',
                                plugins: prettierPlugins,
                                singleQuote: true,
                                trailingComma: 'es5',
                                tabWidth: 2,
                                semi: true
                            });
                        } catch (error) {
                            throw new Error(`JavaScript/TypeScript æ ¼å¼åŒ–é”™è¯¯: ${error.message}`);
                        }
                        break;

                    case 'html':
                        try {
                            formattedCode = prettier.format(code, {
                                parser: 'html',
                                plugins: prettierPlugins,
                                tabWidth: 2,
                                htmlWhitespaceSensitivity: 'css'
                            });
                        } catch (error) {
                            throw new Error(`HTML æ ¼å¼åŒ–é”™è¯¯: ${error.message}`);
                        }
                        break;

                    case 'css':
                        try {
                            formattedCode = prettier.format(code, {
                                parser: 'css',
                                plugins: prettierPlugins,
                                tabWidth: 2
                            });
                        } catch (error) {
                            throw new Error(`CSS æ ¼å¼åŒ–é”™è¯¯: ${error.message}`);
                        }
                        break;

                    case 'json':
                        try {
                            const parsed = JSON.parse(code);
                            formattedCode = JSON.stringify(parsed, null, 2);
                        } catch (error) {
                            throw new Error(`JSON æ ¼å¼åŒ–é”™è¯¯: ${error.message}`);
                        }
                        break;

                    case 'yaml':
                        try {
                            formattedCode = prettier.format(code, {
                                parser: 'yaml',
                                plugins: prettierPlugins,
                                tabWidth: 2
                            });
                        } catch (error) {
                            // YAMLæ ¼å¼åŒ–å¤±è´¥æ—¶ä¿æŒåŸæ ·
                            formattedCode = code;
                        }
                        break;

                    case 'markdown':
                        try {
                            formattedCode = prettier.format(code, {
                                parser: 'markdown',
                                plugins: prettierPlugins,
                                tabWidth: 2,
                                proseWrap: 'preserve'
                            });
                        } catch (error) {
                            formattedCode = code;
                        }
                        break;

                    case 'graphql':
                        try {
                            formattedCode = prettier.format(code, {
                                parser: 'graphql',
                                plugins: prettierPlugins,
                                tabWidth: 2
                            });
                        } catch (error) {
                            formattedCode = code;
                        }
                        break;

                    default:
                        // å¯¹äºä¸æ”¯æŒprettieræ ¼å¼åŒ–çš„è¯­è¨€ï¼Œä¿æŒåŸæ ·ä½†è¿›è¡ŒåŸºæœ¬çš„ç¼©è¿›å¤„ç†
                        formattedCode = code.split('\n').map(line => line.trim()).join('\n');
                        break;
                }

                // æ›´æ–°è¾“å‡ºæ˜¾ç¤º
                updateOutputDisplay(formattedCode, language);
                showStatus('ä»£ç æ ¼å¼åŒ–å®Œæˆï¼', 'success');

            } catch (error) {
                console.error('æ ¼å¼åŒ–å¤±è´¥:', error);
                showStatus(error.message || 'æ ¼å¼åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä»£ç è¯­æ³•', 'error');
            } finally {
                isFormatting = false;
                formatBtn.innerHTML = originalText;
                formatBtn.disabled = false;
            }
        }

        // æ›´æ–°è¾“å‡ºæ˜¾ç¤º
        function updateOutputDisplay(formattedCode, language) {
            const emptyState = document.getElementById('empty-state');
            const outputLineNumbers = document.getElementById('output-line-numbers');
            const outputCode = document.getElementById('output-code');
            const codeElement = outputCode.querySelector('code');

            emptyState.style.display = 'none';
            outputLineNumbers.style.display = 'flex';
            outputCode.style.display = 'block';

            // æ›´æ–°è¡Œå·
            const lines = formattedCode.split('\n');
            let lineNumbers = '';
            for (let i = 1; i <= lines.length; i++) {
                lineNumbers += `<span>${i}</span>`;
            }
            outputLineNumbers.innerHTML = lineNumbers;

            // æ›´æ–°ä»£ç å†…å®¹
            codeElement.textContent = formattedCode;
            codeElement.className = `language-${highlightLangMap[language] || 'plaintext'}`;

            // åº”ç”¨è¯­æ³•é«˜äº®
            hljs.highlightElement(codeElement);

            // åŒæ­¥æ»šåŠ¨
            const codeOutput = outputCode.parentElement;
            codeOutput.addEventListener('scroll', function () {
                outputLineNumbers.scrollTop = codeOutput.scrollTop;
            });
        }

        // å¤åˆ¶åŠŸèƒ½
        function copyCode() {
            const outputCode = document.getElementById('output-code');
            if (outputCode.style.display === 'none') {
                showStatus('æ²¡æœ‰å¯å¤åˆ¶çš„æ ¼å¼åŒ–ç»“æœ', 'error');
                return;
            }

            const formattedCode = outputCode.querySelector('code').textContent;

            navigator.clipboard.writeText(formattedCode).then(() => {
                showStatus('æ ¼å¼åŒ–ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            }).catch(() => {
                showStatus('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶', 'error');
            });
        }

        function copyInputCode() {
            const inputCode = document.getElementById('input-code').value;
            if (!inputCode.trim()) {
                showStatus('è¾“å…¥æ¡†ä¸ºç©º', 'error');
                return;
            }

            navigator.clipboard.writeText(inputCode).then(() => {
                showStatus('è¾“å…¥ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            }).catch(() => {
                showStatus('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶', 'error');
            });
        }

        // ä¸‹è½½åŠŸèƒ½
        function downloadCode() {
            const outputCode = document.getElementById('output-code');
            if (outputCode.style.display === 'none') {
                showStatus('æ²¡æœ‰å¯ä¸‹è½½çš„æ ¼å¼åŒ–ç»“æœ', 'error');
                return;
            }

            const formattedCode = outputCode.querySelector('code').textContent;
            const language = document.getElementById('language').value === 'auto' ? lastDetectedLanguage : document.getElementById('language').value;
            const extension = fileExtMap[language] || 'txt';

            downloadFile(formattedCode, `formatted-code.${extension}`);
        }

        function downloadInputCode() {
            const inputCode = document.getElementById('input-code').value;
            if (!inputCode.trim()) {
                showStatus('è¾“å…¥æ¡†ä¸ºç©º', 'error');
                return;
            }

            const language = document.getElementById('language').value === 'auto' ? lastDetectedLanguage : document.getElementById('language').value;
            const extension = fileExtMap[language] || 'txt';

            downloadFile(inputCode, `input-code.${extension}`);
        }

        function downloadFile(content, filename) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showStatus(`æ–‡ä»¶ ${filename} ä¸‹è½½æˆåŠŸ`, 'success');
        }

        // æ¸…ç©ºåŠŸèƒ½
        function clearCode() {
            document.getElementById('input-code').value = '';
            document.getElementById('input-line-numbers').innerHTML = '<span>1</span>';
            document.getElementById('empty-state').style.display = 'flex';
            document.getElementById('output-line-numbers').style.display = 'none';
            document.getElementById('output-code').style.display = 'none';
            document.getElementById('detected-language').classList.remove('show');
            lastDetectedLanguage = '';
            showStatus('å·²æ¸…ç©ºæ‰€æœ‰å†…å®¹', 'info');
            document.getElementById('input-code').focus();
        }
    </script>
</body>

</html>