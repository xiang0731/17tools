<!DOCTYPE html>
<html>

<head>
    <title>WiFi二维码生成器</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="../css/theme.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* 重置页面默认样式 */
        html,
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            width: 100%;
        }

        /* 主容器样式 */
        .wifi-generator {
            width: 100%;
            min-height: 100vh;
            padding: var(--spacing-lg);
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            font-family: var(--font-family);
            overflow-y: auto;
            background-color: var(--background-primary);
            color: var(--text-primary);
        }

        /* 标题样式 */
        h1 {
            text-align: center;
            color: var(--text-primary);
            margin: 0 0 var(--spacing-lg) 0;
            padding: 0;
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }

        h1 i {
            color: var(--primary-color);
            font-size: 32px;
        }

        /* 输入表单样式 */
        .input-section {
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-sm);
        }

        .input-section h2 {
            margin: 0 0 var(--spacing-md) 0;
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .input-section h2 i {
            color: var(--accent-color);
        }

        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 16px;
            box-sizing: border-box;
            font-family: var(--font-family);
            background-color: var(--background-primary);
            color: var(--text-primary);
            transition: all var(--transition-fast);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .form-input::placeholder {
            color: var(--text-tertiary);
        }

        /* 按钮样式 */
        .button-group {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
            flex-wrap: wrap;
        }

        .btn {
            padding: var(--spacing-md) var(--spacing-lg);
            border: none;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-family: var(--font-family);
            flex: 1;
            min-width: 120px;
            justify-content: center;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* 预览区域样式 */
        .preview-section {
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-sm);
        }

        .preview-section h2 {
            margin: 0 0 var(--spacing-md) 0;
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .preview-section h2 i {
            color: var(--warning-color);
        }

        .qr-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
            background: var(--background-primary);
            border: 2px dashed var(--border-color);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            transition: all var(--transition-fast);
        }

        .qr-container.has-qr {
            border-style: solid;
            border-color: var(--success-color);
            background: var(--background-primary);
            padding: var(--spacing-md);
        }

        .qr-placeholder {
            text-align: center;
            color: var(--text-tertiary);
            font-size: 14px;
        }

        .qr-placeholder i {
            font-size: 48px;
            margin-bottom: var(--spacing-sm);
            display: block;
        }

        #qr-canvas {
            max-width: 100%;
            height: auto;
        }

        /* WiFi 信息显示 */
        .wifi-info {
            background: var(--background-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
        }

        .wifi-info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--border-light);
        }

        .wifi-info-item:last-child {
            border-bottom: none;
        }

        .wifi-info-label {
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .wifi-info-value {
            font-family: var(--font-mono);
            color: var(--text-primary);
            font-size: 14px;
            word-break: break-all;
        }

        /* 说明区域样式 */
        .help-section {
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-sm);
        }

        .help-section h2 {
            margin: 0 0 var(--spacing-md) 0;
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .help-section h2 i {
            color: var(--primary-color);
        }

        .help-section p {
            margin: 0 0 var(--spacing-sm) 0;
            color: var(--text-secondary);
            line-height: 1.6;
            font-size: 14px;
        }

        .help-section p:last-child {
            margin-bottom: 0;
        }

        .help-section ul {
            margin: 0;
            padding-left: var(--spacing-lg);
            color: var(--text-secondary);
        }

        .help-section li {
            margin-bottom: var(--spacing-xs);
            line-height: 1.6;
            font-size: 14px;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .wifi-generator {
                padding: var(--spacing-md);
            }

            h1 {
                font-size: 24px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                flex: none;
                min-width: auto;
            }

            .wifi-info-item {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-xs);
            }
        }

        /* 隐藏元素 */
        #qr-temp-container {
            display: none;
        }

        /* 成功提示样式 */
        .success-message {
            background: var(--success-color);
            color: white;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            font-size: 14px;
            text-align: center;
            margin-top: var(--spacing-sm);
            opacity: 0;
            transform: translateY(-10px);
            transition: all var(--transition-fast);
        }

        .success-message.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>

    <!-- QR码生成库 -->
    <script>
        //---------------------------------------------------------------------
        // QRCode for JavaScript
        //
        // Copyright (c) 2009 Kazuhiko Arase
        //
        // URL: http://www.d-project.com/
        //
        // Licensed under the MIT license:
        //   http://www.opensource.org/licenses/mit-license.php
        //
        // The word "QR Code" is registered trademark of
        // DENSO WAVE INCORPORATED
        //   http://www.denso-wave.com/qrcode/faqpatent-e.html
        //
        //---------------------------------------------------------------------

        //---------------------------------------------------------------------
        // QR8bitByte
        //---------------------------------------------------------------------

        function QR8bitByte(data) {
            this.mode = QRMode.MODE_8BIT_BYTE;
            this.data = data;
        }

        QR8bitByte.prototype = {

            getLength: function (buffer) {
                // 返回UTF-8字节长度，而不是字符长度
                return this.stringToUTF8Bytes(this.data).length;
            },

            write: function (buffer) {
                // 将字符串转换为UTF-8字节数组
                var utf8Bytes = this.stringToUTF8Bytes(this.data);
                for (var i = 0; i < utf8Bytes.length; i++) {
                    buffer.put(utf8Bytes[i], 8);
                }
            },

            stringToUTF8Bytes: function (str) {
                var utf8 = [];
                for (var i = 0; i < str.length; i++) {
                    var charCode = str.charCodeAt(i);
                    if (charCode < 0x80) {
                        // ASCII字符
                        utf8.push(charCode);
                    } else if (charCode < 0x800) {
                        // 2字节UTF-8
                        utf8.push(0xc0 | (charCode >> 6));
                        utf8.push(0x80 | (charCode & 0x3f));
                    } else if ((charCode & 0xfc00) === 0xd800 && i + 1 < str.length && (str.charCodeAt(i + 1) & 0xfc00) === 0xdc00) {
                        // 代理对（4字节UTF-8）
                        var surrogate = 0x10000 + (((charCode & 0x3ff) << 10) | (str.charCodeAt(++i) & 0x3ff));
                        utf8.push(0xf0 | (surrogate >> 18));
                        utf8.push(0x80 | ((surrogate >> 12) & 0x3f));
                        utf8.push(0x80 | ((surrogate >> 6) & 0x3f));
                        utf8.push(0x80 | (surrogate & 0x3f));
                    } else {
                        // 3字节UTF-8（包括中文字符）
                        utf8.push(0xe0 | (charCode >> 12));
                        utf8.push(0x80 | ((charCode >> 6) & 0x3f));
                        utf8.push(0x80 | (charCode & 0x3f));
                    }
                }
                return utf8;
            }
        };

        //---------------------------------------------------------------------
        // QRCode
        //---------------------------------------------------------------------

        function QRCode(typeNumber, errorCorrectLevel) {
            this.typeNumber = typeNumber;
            this.errorCorrectLevel = errorCorrectLevel;
            this.modules = null;
            this.moduleCount = 0;
            this.dataCache = null;
            this.dataList = new Array();
        }

        QRCode.prototype = {

            addData: function (data) {
                var newData = new QR8bitByte(data);
                this.dataList.push(newData);
                this.dataCache = null;
            },

            isDark: function (row, col) {
                if (row < 0 || this.moduleCount <= row || col < 0 || this.moduleCount <= col) {
                    throw new Error(row + "," + col);
                }
                return this.modules[row][col];
            },

            getModuleCount: function () {
                return this.moduleCount;
            },

            make: function () {
                // Calculate automatically typeNumber if provided is < 1
                if (this.typeNumber < 1) {
                    var typeNumber = 1;
                    for (typeNumber = 1; typeNumber < 40; typeNumber++) {
                        var rsBlocks = QRRSBlock.getRSBlocks(typeNumber, this.errorCorrectLevel);

                        var buffer = new QRBitBuffer();
                        var totalDataCount = 0;
                        for (var i = 0; i < rsBlocks.length; i++) {
                            totalDataCount += rsBlocks[i].dataCount;
                        }

                        for (var i = 0; i < this.dataList.length; i++) {
                            var data = this.dataList[i];
                            buffer.put(data.mode, 4);
                            buffer.put(data.getLength(), QRUtil.getLengthInBits(data.mode, typeNumber));
                            data.write(buffer);
                        }
                        if (buffer.getLengthInBits() <= totalDataCount * 8)
                            break;
                    }
                    this.typeNumber = typeNumber;
                }
                this.makeImpl(false, this.getBestMaskPattern());
            },

            makeImpl: function (test, maskPattern) {

                this.moduleCount = this.typeNumber * 4 + 17;
                this.modules = new Array(this.moduleCount);

                for (var row = 0; row < this.moduleCount; row++) {

                    this.modules[row] = new Array(this.moduleCount);

                    for (var col = 0; col < this.moduleCount; col++) {
                        this.modules[row][col] = null;//(col + row) % 3;
                    }
                }

                this.setupPositionProbePattern(0, 0);
                this.setupPositionProbePattern(this.moduleCount - 7, 0);
                this.setupPositionProbePattern(0, this.moduleCount - 7);
                this.setupPositionAdjustPattern();
                this.setupTimingPattern();
                this.setupTypeInfo(test, maskPattern);

                if (this.typeNumber >= 7) {
                    this.setupTypeNumber(test);
                }

                if (this.dataCache == null) {
                    this.dataCache = QRCode.createData(this.typeNumber, this.errorCorrectLevel, this.dataList);
                }

                this.mapData(this.dataCache, maskPattern);
            },

            setupPositionProbePattern: function (row, col) {

                for (var r = -1; r <= 7; r++) {

                    if (row + r <= -1 || this.moduleCount <= row + r) continue;

                    for (var c = -1; c <= 7; c++) {

                        if (col + c <= -1 || this.moduleCount <= col + c) continue;

                        if ((0 <= r && r <= 6 && (c == 0 || c == 6))
                            || (0 <= c && c <= 6 && (r == 0 || r == 6))
                            || (2 <= r && r <= 4 && 2 <= c && c <= 4)) {
                            this.modules[row + r][col + c] = true;
                        } else {
                            this.modules[row + r][col + c] = false;
                        }
                    }
                }
            },

            getBestMaskPattern: function () {

                var minLostPoint = 0;
                var pattern = 0;

                for (var i = 0; i < 8; i++) {

                    this.makeImpl(true, i);

                    var lostPoint = QRUtil.getLostPoint(this);

                    if (i == 0 || minLostPoint > lostPoint) {
                        minLostPoint = lostPoint;
                        pattern = i;
                    }
                }

                return pattern;
            },

            createMovieClip: function (target_mc, instance_name, depth) {

                var qr_mc = target_mc.createEmptyMovieClip(instance_name, depth);
                var cs = 1;

                this.make();

                for (var row = 0; row < this.modules.length; row++) {

                    var y = row * cs;

                    for (var col = 0; col < this.modules[row].length; col++) {

                        var x = col * cs;
                        var dark = this.modules[row][col];

                        if (dark) {
                            qr_mc.beginFill(0, 100);
                            qr_mc.moveTo(x, y);
                            qr_mc.lineTo(x + cs, y);
                            qr_mc.lineTo(x + cs, y + cs);
                            qr_mc.lineTo(x, y + cs);
                            qr_mc.endFill();
                        }
                    }
                }

                return qr_mc;
            },

            setupTimingPattern: function () {

                for (var r = 8; r < this.moduleCount - 8; r++) {
                    if (this.modules[r][6] != null) {
                        continue;
                    }
                    this.modules[r][6] = (r % 2 == 0);
                }

                for (var c = 8; c < this.moduleCount - 8; c++) {
                    if (this.modules[6][c] != null) {
                        continue;
                    }
                    this.modules[6][c] = (c % 2 == 0);
                }
            },

            setupPositionAdjustPattern: function () {

                var pos = QRUtil.getPatternPosition(this.typeNumber);

                for (var i = 0; i < pos.length; i++) {

                    for (var j = 0; j < pos.length; j++) {

                        var row = pos[i];
                        var col = pos[j];

                        if (this.modules[row][col] != null) {
                            continue;
                        }

                        for (var r = -2; r <= 2; r++) {

                            for (var c = -2; c <= 2; c++) {

                                if (r == -2 || r == 2 || c == -2 || c == 2
                                    || (r == 0 && c == 0)) {
                                    this.modules[row + r][col + c] = true;
                                } else {
                                    this.modules[row + r][col + c] = false;
                                }
                            }
                        }
                    }
                }
            },

            setupTypeNumber: function (test) {

                var bits = QRUtil.getBCHTypeNumber(this.typeNumber);

                for (var i = 0; i < 18; i++) {
                    var mod = (!test && ((bits >> i) & 1) == 1);
                    this.modules[Math.floor(i / 3)][i % 3 + this.moduleCount - 8 - 3] = mod;
                }

                for (var i = 0; i < 18; i++) {
                    var mod = (!test && ((bits >> i) & 1) == 1);
                    this.modules[i % 3 + this.moduleCount - 8 - 3][Math.floor(i / 3)] = mod;
                }
            },

            setupTypeInfo: function (test, maskPattern) {

                var data = (this.errorCorrectLevel << 3) | maskPattern;
                var bits = QRUtil.getBCHTypeInfo(data);

                // vertical
                for (var i = 0; i < 15; i++) {

                    var mod = (!test && ((bits >> i) & 1) == 1);

                    if (i < 6) {
                        this.modules[i][8] = mod;
                    } else if (i < 8) {
                        this.modules[i + 1][8] = mod;
                    } else {
                        this.modules[this.moduleCount - 15 + i][8] = mod;
                    }
                }

                // horizontal
                for (var i = 0; i < 15; i++) {

                    var mod = (!test && ((bits >> i) & 1) == 1);

                    if (i < 8) {
                        this.modules[8][this.moduleCount - i - 1] = mod;
                    } else if (i < 9) {
                        this.modules[8][15 - i - 1 + 1] = mod;
                    } else {
                        this.modules[8][15 - i - 1] = mod;
                    }
                }

                // fixed module
                this.modules[this.moduleCount - 8][8] = (!test);

            },

            mapData: function (data, maskPattern) {

                var inc = -1;
                var row = this.moduleCount - 1;
                var bitIndex = 7;
                var byteIndex = 0;

                for (var col = this.moduleCount - 1; col > 0; col -= 2) {

                    if (col == 6) col--;

                    while (true) {

                        for (var c = 0; c < 2; c++) {

                            if (this.modules[row][col - c] == null) {

                                var dark = false;

                                if (byteIndex < data.length) {
                                    dark = (((data[byteIndex] >>> bitIndex) & 1) == 1);
                                }

                                var mask = QRUtil.getMask(maskPattern, row, col - c);

                                if (mask) {
                                    dark = !dark;
                                }

                                this.modules[row][col - c] = dark;
                                bitIndex--;

                                if (bitIndex == -1) {
                                    byteIndex++;
                                    bitIndex = 7;
                                }
                            }
                        }

                        row += inc;

                        if (row < 0 || this.moduleCount <= row) {
                            row -= inc;
                            inc = -inc;
                            break;
                        }
                    }
                }

            }

        };

        QRCode.PAD0 = 0xEC;
        QRCode.PAD1 = 0x11;

        QRCode.createData = function (typeNumber, errorCorrectLevel, dataList) {

            var rsBlocks = QRRSBlock.getRSBlocks(typeNumber, errorCorrectLevel);

            var buffer = new QRBitBuffer();

            for (var i = 0; i < dataList.length; i++) {
                var data = dataList[i];
                buffer.put(data.mode, 4);
                buffer.put(data.getLength(), QRUtil.getLengthInBits(data.mode, typeNumber));
                data.write(buffer);
            }

            // calc num max data.
            var totalDataCount = 0;
            for (var i = 0; i < rsBlocks.length; i++) {
                totalDataCount += rsBlocks[i].dataCount;
            }

            if (buffer.getLengthInBits() > totalDataCount * 8) {
                throw new Error("code length overflow. ("
                    + buffer.getLengthInBits()
                    + ">"
                    + totalDataCount * 8
                    + ")");
            }

            // end code
            if (buffer.getLengthInBits() + 4 <= totalDataCount * 8) {
                buffer.put(0, 4);
            }

            // padding
            while (buffer.getLengthInBits() % 8 != 0) {
                buffer.putBit(false);
            }

            // padding
            while (true) {

                if (buffer.getLengthInBits() >= totalDataCount * 8) {
                    break;
                }
                buffer.put(QRCode.PAD0, 8);

                if (buffer.getLengthInBits() >= totalDataCount * 8) {
                    break;
                }
                buffer.put(QRCode.PAD1, 8);
            }

            return QRCode.createBytes(buffer, rsBlocks);
        }

        QRCode.createBytes = function (buffer, rsBlocks) {

            var offset = 0;

            var maxDcCount = 0;
            var maxEcCount = 0;

            var dcdata = new Array(rsBlocks.length);
            var ecdata = new Array(rsBlocks.length);

            for (var r = 0; r < rsBlocks.length; r++) {

                var dcCount = rsBlocks[r].dataCount;
                var ecCount = rsBlocks[r].totalCount - dcCount;

                maxDcCount = Math.max(maxDcCount, dcCount);
                maxEcCount = Math.max(maxEcCount, ecCount);

                dcdata[r] = new Array(dcCount);

                for (var i = 0; i < dcdata[r].length; i++) {
                    dcdata[r][i] = 0xff & buffer.buffer[i + offset];
                }
                offset += dcCount;

                var rsPoly = QRUtil.getErrorCorrectPolynomial(ecCount);
                var rawPoly = new QRPolynomial(dcdata[r], rsPoly.getLength() - 1);

                var modPoly = rawPoly.mod(rsPoly);
                ecdata[r] = new Array(rsPoly.getLength() - 1);
                for (var i = 0; i < ecdata[r].length; i++) {
                    var modIndex = i + modPoly.getLength() - ecdata[r].length;
                    ecdata[r][i] = (modIndex >= 0) ? modPoly.get(modIndex) : 0;
                }

            }

            var totalCodeCount = 0;
            for (var i = 0; i < rsBlocks.length; i++) {
                totalCodeCount += rsBlocks[i].totalCount;
            }

            var data = new Array(totalCodeCount);
            var index = 0;

            for (var i = 0; i < maxDcCount; i++) {
                for (var r = 0; r < rsBlocks.length; r++) {
                    if (i < dcdata[r].length) {
                        data[index++] = dcdata[r][i];
                    }
                }
            }

            for (var i = 0; i < maxEcCount; i++) {
                for (var r = 0; r < rsBlocks.length; r++) {
                    if (i < ecdata[r].length) {
                        data[index++] = ecdata[r][i];
                    }
                }
            }

            return data;

        }

        //---------------------------------------------------------------------
        // QRMode
        //---------------------------------------------------------------------

        var QRMode = {
            MODE_NUMBER: 1 << 0,
            MODE_ALPHA_NUM: 1 << 1,
            MODE_8BIT_BYTE: 1 << 2,
            MODE_KANJI: 1 << 3
        };

        //---------------------------------------------------------------------
        // QRErrorCorrectLevel
        //---------------------------------------------------------------------

        var QRErrorCorrectLevel = {
            L: 1,
            M: 0,
            Q: 3,
            H: 2
        };

        //---------------------------------------------------------------------
        // QRMaskPattern
        //---------------------------------------------------------------------

        var QRMaskPattern = {
            PATTERN000: 0,
            PATTERN001: 1,
            PATTERN010: 2,
            PATTERN011: 3,
            PATTERN100: 4,
            PATTERN101: 5,
            PATTERN110: 6,
            PATTERN111: 7
        };

        //---------------------------------------------------------------------
        // QRUtil
        //---------------------------------------------------------------------

        var QRUtil = {

            PATTERN_POSITION_TABLE: [
                [],
                [6, 18],
                [6, 22],
                [6, 26],
                [6, 30],
                [6, 34],
                [6, 22, 38],
                [6, 24, 42],
                [6, 26, 46],
                [6, 28, 50],
                [6, 30, 54],
                [6, 32, 58],
                [6, 34, 62],
                [6, 26, 46, 66],
                [6, 26, 48, 70],
                [6, 26, 50, 74],
                [6, 30, 54, 78],
                [6, 30, 56, 82],
                [6, 30, 58, 86],
                [6, 34, 62, 90],
                [6, 28, 50, 72, 94],
                [6, 26, 50, 74, 98],
                [6, 30, 54, 78, 102],
                [6, 28, 54, 80, 106],
                [6, 32, 58, 84, 110],
                [6, 30, 58, 86, 114],
                [6, 34, 62, 90, 118],
                [6, 26, 50, 74, 98, 122],
                [6, 30, 54, 78, 102, 126],
                [6, 26, 52, 78, 104, 130],
                [6, 30, 56, 82, 108, 134],
                [6, 34, 60, 86, 112, 138],
                [6, 30, 58, 86, 114, 142],
                [6, 34, 62, 90, 118, 146],
                [6, 30, 54, 78, 102, 126, 150],
                [6, 24, 50, 76, 102, 128, 154],
                [6, 28, 54, 80, 106, 132, 158],
                [6, 32, 58, 84, 110, 136, 162],
                [6, 26, 54, 82, 110, 138, 166],
                [6, 30, 58, 86, 114, 142, 170]
            ],

            G15: (1 << 10) | (1 << 8) | (1 << 5) | (1 << 4) | (1 << 2) | (1 << 1) | (1 << 0),
            G18: (1 << 12) | (1 << 11) | (1 << 10) | (1 << 9) | (1 << 8) | (1 << 5) | (1 << 2) | (1 << 0),
            G15_MASK: (1 << 14) | (1 << 12) | (1 << 10) | (1 << 4) | (1 << 1),

            getBCHTypeInfo: function (data) {
                var d = data << 10;
                while (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G15) >= 0) {
                    d ^= (QRUtil.G15 << (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G15)));
                }
                return ((data << 10) | d) ^ QRUtil.G15_MASK;
            },

            getBCHTypeNumber: function (data) {
                var d = data << 12;
                while (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G18) >= 0) {
                    d ^= (QRUtil.G18 << (QRUtil.getBCHDigit(d) - QRUtil.getBCHDigit(QRUtil.G18)));
                }
                return (data << 12) | d;
            },

            getBCHDigit: function (data) {

                var digit = 0;

                while (data != 0) {
                    digit++;
                    data >>>= 1;
                }

                return digit;
            },

            getPatternPosition: function (typeNumber) {
                return QRUtil.PATTERN_POSITION_TABLE[typeNumber - 1];
            },

            getMask: function (maskPattern, i, j) {

                switch (maskPattern) {

                    case QRMaskPattern.PATTERN000:
                        return (i + j) % 2 == 0;
                    case QRMaskPattern.PATTERN001:
                        return i % 2 == 0;
                    case QRMaskPattern.PATTERN010:
                        return j % 3 == 0;
                    case QRMaskPattern.PATTERN011:
                        return (i + j) % 3 == 0;
                    case QRMaskPattern.PATTERN100:
                        return (Math.floor(i / 2) + Math.floor(j / 3)) % 2 == 0;
                    case QRMaskPattern.PATTERN101:
                        return (i * j) % 2 + (i * j) % 3 == 0;
                    case QRMaskPattern.PATTERN110:
                        return ((i * j) % 2 + (i * j) % 3) % 2 == 0;
                    case QRMaskPattern.PATTERN111:
                        return ((i * j) % 3 + (i + j) % 2) % 2 == 0;

                    default:
                        throw new Error("bad maskPattern:" + maskPattern);
                }
            },

            getErrorCorrectPolynomial: function (errorCorrectLength) {

                var a = new QRPolynomial([1], 0);

                for (var i = 0; i < errorCorrectLength; i++) {
                    a = a.multiply(new QRPolynomial([1, QRMath.gexp(i)], 0));
                }

                return a;
            },

            getLengthInBits: function (mode, type) {

                if (1 <= type && type < 10) {

                    // 1 - 9

                    switch (mode) {
                        case QRMode.MODE_NUMBER:
                            return 10;
                        case QRMode.MODE_ALPHA_NUM:
                            return 9;
                        case QRMode.MODE_8BIT_BYTE:
                            return 8;
                        case QRMode.MODE_KANJI:
                            return 8;
                        default:
                            throw new Error("mode:" + mode);
                    }

                } else if (type < 27) {

                    // 10 - 26

                    switch (mode) {
                        case QRMode.MODE_NUMBER:
                            return 12;
                        case QRMode.MODE_ALPHA_NUM:
                            return 11;
                        case QRMode.MODE_8BIT_BYTE:
                            return 16;
                        case QRMode.MODE_KANJI:
                            return 10;
                        default:
                            throw new Error("mode:" + mode);
                    }

                } else if (type < 41) {

                    // 27 - 40

                    switch (mode) {
                        case QRMode.MODE_NUMBER:
                            return 14;
                        case QRMode.MODE_ALPHA_NUM:
                            return 13;
                        case QRMode.MODE_8BIT_BYTE:
                            return 16;
                        case QRMode.MODE_KANJI:
                            return 12;
                        default:
                            throw new Error("mode:" + mode);
                    }

                } else {
                    throw new Error("type:" + type);
                }
            },

            getLostPoint: function (qrCode) {

                var moduleCount = qrCode.getModuleCount();

                var lostPoint = 0;

                // LEVEL1

                for (var row = 0; row < moduleCount; row++) {

                    for (var col = 0; col < moduleCount; col++) {

                        var sameCount = 0;
                        var dark = qrCode.isDark(row, col);

                        for (var r = -1; r <= 1; r++) {

                            if (row + r < 0 || moduleCount <= row + r) {
                                continue;
                            }

                            for (var c = -1; c <= 1; c++) {

                                if (col + c < 0 || moduleCount <= col + c) {
                                    continue;
                                }

                                if (r == 0 && c == 0) {
                                    continue;
                                }

                                if (dark == qrCode.isDark(row + r, col + c)) {
                                    sameCount++;
                                }
                            }
                        }

                        if (sameCount > 5) {
                            lostPoint += (3 + sameCount - 5);
                        }
                    }
                }

                // LEVEL2

                for (var row = 0; row < moduleCount - 1; row++) {
                    for (var col = 0; col < moduleCount - 1; col++) {
                        var count = 0;
                        if (qrCode.isDark(row, col)) count++;
                        if (qrCode.isDark(row + 1, col)) count++;
                        if (qrCode.isDark(row, col + 1)) count++;
                        if (qrCode.isDark(row + 1, col + 1)) count++;
                        if (count == 0 || count == 4) {
                            lostPoint += 3;
                        }
                    }
                }

                // LEVEL3

                for (var row = 0; row < moduleCount; row++) {
                    for (var col = 0; col < moduleCount - 6; col++) {
                        if (qrCode.isDark(row, col)
                            && !qrCode.isDark(row, col + 1)
                            && qrCode.isDark(row, col + 2)
                            && qrCode.isDark(row, col + 3)
                            && qrCode.isDark(row, col + 4)
                            && !qrCode.isDark(row, col + 5)
                            && qrCode.isDark(row, col + 6)) {
                            lostPoint += 40;
                        }
                    }
                }

                for (var col = 0; col < moduleCount; col++) {
                    for (var row = 0; row < moduleCount - 6; row++) {
                        if (qrCode.isDark(row, col)
                            && !qrCode.isDark(row + 1, col)
                            && qrCode.isDark(row + 2, col)
                            && qrCode.isDark(row + 3, col)
                            && qrCode.isDark(row + 4, col)
                            && !qrCode.isDark(row + 5, col)
                            && qrCode.isDark(row + 6, col)) {
                            lostPoint += 40;
                        }
                    }
                }

                // LEVEL4

                var darkCount = 0;

                for (var col = 0; col < moduleCount; col++) {
                    for (var row = 0; row < moduleCount; row++) {
                        if (qrCode.isDark(row, col)) {
                            darkCount++;
                        }
                    }
                }

                var ratio = Math.abs(100 * darkCount / moduleCount / moduleCount - 50) / 5;
                lostPoint += ratio * 10;

                return lostPoint;
            }

        };


        //---------------------------------------------------------------------
        // QRMath
        //---------------------------------------------------------------------

        var QRMath = {

            glog: function (n) {

                if (n < 1) {
                    throw new Error("glog(" + n + ")");
                }

                return QRMath.LOG_TABLE[n];
            },

            gexp: function (n) {

                while (n < 0) {
                    n += 255;
                }

                while (n >= 256) {
                    n -= 255;
                }

                return QRMath.EXP_TABLE[n];
            },

            EXP_TABLE: new Array(256),

            LOG_TABLE: new Array(256)

        };

        for (var i = 0; i < 8; i++) {
            QRMath.EXP_TABLE[i] = 1 << i;
        }
        for (var i = 8; i < 256; i++) {
            QRMath.EXP_TABLE[i] = QRMath.EXP_TABLE[i - 4]
                ^ QRMath.EXP_TABLE[i - 5]
                ^ QRMath.EXP_TABLE[i - 6]
                ^ QRMath.EXP_TABLE[i - 8];
        }
        for (var i = 0; i < 255; i++) {
            QRMath.LOG_TABLE[QRMath.EXP_TABLE[i]] = i;
        }

        //---------------------------------------------------------------------
        // QRPolynomial
        //---------------------------------------------------------------------

        function QRPolynomial(num, shift) {

            if (num.length == undefined) {
                throw new Error(num.length + "/" + shift);
            }

            var offset = 0;

            while (offset < num.length && num[offset] == 0) {
                offset++;
            }

            this.num = new Array(num.length - offset + shift);
            for (var i = 0; i < num.length - offset; i++) {
                this.num[i] = num[i + offset];
            }
        }

        QRPolynomial.prototype = {

            get: function (index) {
                return this.num[index];
            },

            getLength: function () {
                return this.num.length;
            },

            multiply: function (e) {

                var num = new Array(this.getLength() + e.getLength() - 1);

                for (var i = 0; i < this.getLength(); i++) {
                    for (var j = 0; j < e.getLength(); j++) {
                        num[i + j] ^= QRMath.gexp(QRMath.glog(this.get(i)) + QRMath.glog(e.get(j)));
                    }
                }

                return new QRPolynomial(num, 0);
            },

            mod: function (e) {

                if (this.getLength() - e.getLength() < 0) {
                    return this;
                }

                var ratio = QRMath.glog(this.get(0)) - QRMath.glog(e.get(0));

                var num = new Array(this.getLength());

                for (var i = 0; i < this.getLength(); i++) {
                    num[i] = this.get(i);
                }

                for (var i = 0; i < e.getLength(); i++) {
                    num[i] ^= QRMath.gexp(QRMath.glog(e.get(i)) + ratio);
                }

                // recursive call
                return new QRPolynomial(num, 0).mod(e);
            }
        };

        //---------------------------------------------------------------------
        // QRRSBlock
        //---------------------------------------------------------------------

        function QRRSBlock(totalCount, dataCount) {
            this.totalCount = totalCount;
            this.dataCount = dataCount;
        }

        QRRSBlock.RS_BLOCK_TABLE = [

            // L
            // M
            // Q
            // H

            // 1
            [1, 26, 19],
            [1, 26, 16],
            [1, 26, 13],
            [1, 26, 9],

            // 2
            [1, 44, 34],
            [1, 44, 28],
            [1, 44, 22],
            [1, 44, 16],

            // 3
            [1, 70, 55],
            [1, 70, 44],
            [2, 35, 17],
            [2, 35, 13],

            // 4
            [1, 100, 80],
            [2, 50, 32],
            [2, 50, 24],
            [4, 25, 9],

            // 5
            [1, 134, 108],
            [2, 67, 43],
            [2, 33, 15, 2, 34, 16],
            [2, 33, 11, 2, 34, 12],

            // 6
            [2, 86, 68],
            [4, 43, 27],
            [4, 43, 19],
            [4, 43, 15],

            // 7
            [2, 98, 78],
            [4, 49, 31],
            [2, 32, 14, 4, 33, 15],
            [4, 39, 13, 1, 40, 14],

            // 8
            [2, 121, 97],
            [2, 60, 38, 2, 61, 39],
            [4, 40, 18, 2, 41, 19],
            [4, 40, 14, 2, 41, 15],

            // 9
            [2, 146, 116],
            [3, 58, 36, 2, 59, 37],
            [4, 36, 16, 4, 37, 17],
            [4, 36, 12, 4, 37, 13],

            // 10
            [2, 86, 68, 2, 87, 69],
            [4, 69, 43, 1, 70, 44],
            [6, 43, 19, 2, 44, 20],
            [6, 43, 15, 2, 44, 16],

            // 11
            [4, 101, 81],
            [1, 80, 50, 4, 81, 51],
            [4, 50, 22, 4, 51, 23],
            [3, 36, 12, 8, 37, 13],

            // 12
            [2, 116, 92, 2, 117, 93],
            [6, 58, 36, 2, 59, 37],
            [4, 46, 20, 6, 47, 21],
            [7, 42, 14, 4, 43, 15],

            // 13
            [4, 133, 107],
            [8, 59, 37, 1, 60, 38],
            [8, 44, 20, 4, 45, 21],
            [12, 33, 11, 4, 34, 12],

            // 14
            [3, 145, 115, 1, 146, 116],
            [4, 64, 40, 5, 65, 41],
            [11, 36, 16, 5, 37, 17],
            [11, 36, 12, 5, 37, 13],

            // 15
            [5, 109, 87, 1, 110, 88],
            [5, 65, 41, 5, 66, 42],
            [5, 54, 24, 7, 55, 25],
            [11, 36, 12],

            // 16
            [5, 122, 98, 1, 123, 99],
            [7, 73, 45, 3, 74, 46],
            [15, 43, 19, 2, 44, 20],
            [3, 45, 15, 13, 46, 16],

            // 17
            [1, 135, 107, 5, 136, 108],
            [10, 74, 46, 1, 75, 47],
            [1, 50, 22, 15, 51, 23],
            [2, 42, 14, 17, 43, 15],

            // 18
            [5, 150, 120, 1, 151, 121],
            [9, 69, 43, 4, 70, 44],
            [17, 50, 22, 1, 51, 23],
            [2, 42, 14, 19, 43, 15],

            // 19
            [3, 141, 113, 4, 142, 114],
            [3, 70, 44, 11, 71, 45],
            [17, 47, 21, 4, 48, 22],
            [9, 39, 13, 16, 40, 14],

            // 20
            [3, 135, 107, 5, 136, 108],
            [3, 67, 41, 13, 68, 42],
            [15, 54, 24, 5, 55, 25],
            [15, 43, 15, 10, 44, 16],

            // 21
            [4, 144, 116, 4, 145, 117],
            [17, 68, 42],
            [17, 50, 22, 6, 51, 23],
            [19, 46, 16, 6, 47, 17],

            // 22
            [2, 139, 111, 7, 140, 112],
            [17, 74, 46],
            [7, 54, 24, 16, 55, 25],
            [34, 37, 13],

            // 23
            [4, 151, 121, 5, 152, 122],
            [4, 75, 47, 14, 76, 48],
            [11, 54, 24, 14, 55, 25],
            [16, 45, 15, 14, 46, 16],

            // 24
            [6, 147, 117, 4, 148, 118],
            [6, 73, 45, 14, 74, 46],
            [11, 54, 24, 16, 55, 25],
            [30, 46, 16, 2, 47, 17],

            // 25
            [8, 132, 106, 4, 133, 107],
            [8, 75, 47, 13, 76, 48],
            [7, 54, 24, 22, 55, 25],
            [22, 45, 15, 13, 46, 16],

            // 26
            [10, 142, 114, 2, 143, 115],
            [19, 74, 46, 4, 75, 47],
            [28, 50, 22, 6, 51, 23],
            [33, 46, 16, 4, 47, 17],

            // 27
            [8, 152, 122, 4, 153, 123],
            [22, 73, 45, 3, 74, 46],
            [8, 53, 23, 26, 54, 24],
            [12, 45, 15, 28, 46, 16],

            // 28
            [3, 147, 117, 10, 148, 118],
            [3, 73, 45, 23, 74, 46],
            [4, 54, 24, 31, 55, 25],
            [11, 45, 15, 31, 46, 16],

            // 29
            [7, 146, 116, 7, 147, 117],
            [21, 73, 45, 7, 74, 46],
            [1, 53, 23, 37, 54, 24],
            [19, 45, 15, 26, 46, 16],

            // 30
            [5, 145, 115, 10, 146, 116],
            [19, 75, 47, 10, 76, 48],
            [15, 54, 24, 25, 55, 25],
            [23, 45, 15, 25, 46, 16],

            // 31
            [13, 145, 115, 3, 146, 116],
            [2, 74, 46, 29, 75, 47],
            [42, 54, 24, 1, 55, 25],
            [23, 45, 15, 28, 46, 16],

            // 32
            [17, 145, 115],
            [10, 74, 46, 23, 75, 47],
            [10, 54, 24, 35, 55, 25],
            [19, 45, 15, 35, 46, 16],

            // 33
            [17, 145, 115, 1, 146, 116],
            [14, 74, 46, 21, 75, 47],
            [29, 54, 24, 19, 55, 25],
            [11, 45, 15, 46, 46, 16],

            // 34
            [13, 145, 115, 6, 146, 116],
            [14, 74, 46, 23, 75, 47],
            [44, 54, 24, 7, 55, 25],
            [59, 46, 16, 1, 47, 17],

            // 35
            [12, 151, 121, 7, 152, 122],
            [12, 75, 47, 26, 76, 48],
            [39, 54, 24, 14, 55, 25],
            [22, 45, 15, 41, 46, 16],

            // 36
            [6, 151, 121, 14, 152, 122],
            [6, 75, 47, 34, 76, 48],
            [46, 54, 24, 10, 55, 25],
            [2, 45, 15, 64, 46, 16],

            // 37
            [17, 152, 122, 4, 153, 123],
            [29, 74, 46, 14, 75, 47],
            [49, 54, 24, 10, 55, 25],
            [24, 45, 15, 46, 46, 16],

            // 38
            [4, 152, 122, 18, 153, 123],
            [13, 74, 46, 32, 75, 47],
            [48, 54, 24, 14, 55, 25],
            [42, 45, 15, 32, 46, 16],

            // 39
            [20, 147, 117, 4, 148, 118],
            [40, 75, 47, 7, 76, 48],
            [43, 54, 24, 22, 55, 25],
            [10, 45, 15, 67, 46, 16],

            // 40
            [19, 148, 118, 6, 149, 119],
            [18, 75, 47, 31, 76, 48],
            [34, 54, 24, 34, 55, 25],
            [20, 45, 15, 61, 46, 16]
        ];

        QRRSBlock.getRSBlocks = function (typeNumber, errorCorrectLevel) {

            var rsBlock = QRRSBlock.getRsBlockTable(typeNumber, errorCorrectLevel);

            if (rsBlock == undefined) {
                throw new Error("bad rs block @ typeNumber:" + typeNumber + "/errorCorrectLevel:" + errorCorrectLevel);
            }

            var length = rsBlock.length / 3;

            var list = new Array();

            for (var i = 0; i < length; i++) {

                var count = rsBlock[i * 3 + 0];
                var totalCount = rsBlock[i * 3 + 1];
                var dataCount = rsBlock[i * 3 + 2];

                for (var j = 0; j < count; j++) {
                    list.push(new QRRSBlock(totalCount, dataCount));
                }
            }

            return list;
        }

        QRRSBlock.getRsBlockTable = function (typeNumber, errorCorrectLevel) {

            switch (errorCorrectLevel) {
                case QRErrorCorrectLevel.L:
                    return QRRSBlock.RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 0];
                case QRErrorCorrectLevel.M:
                    return QRRSBlock.RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 1];
                case QRErrorCorrectLevel.Q:
                    return QRRSBlock.RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 2];
                case QRErrorCorrectLevel.H:
                    return QRRSBlock.RS_BLOCK_TABLE[(typeNumber - 1) * 4 + 3];
                default:
                    return undefined;
            }
        }

        //---------------------------------------------------------------------
        // QRBitBuffer
        //---------------------------------------------------------------------

        function QRBitBuffer() {
            this.buffer = new Array();
            this.length = 0;
        }

        QRBitBuffer.prototype = {

            get: function (index) {
                var bufIndex = Math.floor(index / 8);
                return ((this.buffer[bufIndex] >>> (7 - index % 8)) & 1) == 1;
            },

            put: function (num, length) {
                for (var i = 0; i < length; i++) {
                    this.putBit(((num >>> (length - i - 1)) & 1) == 1);
                }
            },

            getLengthInBits: function () {
                return this.length;
            },

            putBit: function (bit) {

                var bufIndex = Math.floor(this.length / 8);
                if (this.buffer.length <= bufIndex) {
                    this.buffer.push(0);
                }

                if (bit) {
                    this.buffer[bufIndex] |= (0x80 >>> (this.length % 8));
                }

                this.length++;
            }
        };

        /*
        Copyright (c) 2011 Jerome Etienne, http://jetienne.com
    
        Permission is hereby granted, free of charge, to any person obtaining
        a copy of this software and associated documentation files (the
        "Software"), to deal in the Software without restriction, including
        without limitation the rights to use, copy, modify, merge, publish,
        distribute, sublicense, and/or sell copies of the Software, and to
        permit persons to whom the Software is furnished to do so, subject to
        the following conditions:
    
        The above copyright notice and this permission notice shall be
        included in all copies or substantial portions of the Software.
    
        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
        EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
        MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
        NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
        LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
        OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
        WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
         */

        (function () {
            window.qrcode = function (element, options) {

                var createCanvas = function () {
                    // create the qrcode itself
                    var qrcode = new QRCode(options.typeNumber, options.correctLevel);
                    qrcode.addData(options.text);
                    qrcode.make();

                    // create canvas element
                    var canvas = document.createElement('canvas');
                    canvas.width = options.width;
                    canvas.height = options.height;
                    var ctx = canvas.getContext('2d');

                    // compute tileW/tileH based on options.width/options.height
                    var tileW = options.width / qrcode.getModuleCount();
                    var tileH = options.height / qrcode.getModuleCount();

                    // draw in the canvas
                    for (var row = 0; row < qrcode.getModuleCount(); row++) {
                        for (var col = 0; col < qrcode.getModuleCount(); col++) {
                            ctx.fillStyle = qrcode.isDark(row, col) ? options.foreground : options.background;
                            var w = (Math.ceil((col + 1) * tileW) - Math.floor(col * tileW));
                            var h = (Math.ceil((row + 1) * tileW) - Math.floor(row * tileW));
                            ctx.fillRect(Math.round(col * tileW), Math.round(row * tileH), w, h);
                        }
                    }
                    // return just built canvas
                    return canvas;
                };

                element.innerHTML = '';
                element.appendChild(createCanvas());

            };
        })();

    </script>
</head>

<body>
    <div class="wifi-generator">
        <h1>
            <i class="fas fa-wifi"></i>
            WiFi二维码生成器
        </h1>

        <!-- 输入表单 -->
        <div class="input-section">
            <h2>
                <i class="fas fa-edit"></i>
                WiFi信息设置
            </h2>
            <form id="wifi-form">
                <div class="form-group">
                    <label class="form-label" for="ssid">WiFi名称 (SSID)</label>
                    <input type="text" id="ssid" class="form-input" placeholder="请输入WiFi名称，例如：家里的WiFi" value="我的WiFi"
                        maxlength="32" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="password">WiFi密码</label>
                    <input type="text" id="password" class="form-input" placeholder="请输入WiFi密码" value="12345678"
                        maxlength="63" required>
                </div>
                <div class="button-group">
                    <button type="button" class="btn btn-primary" onclick="generateQRCode()">
                        <i class="fas fa-qrcode"></i>
                        生成二维码
                    </button>
                    <button type="button" class="btn btn-success" onclick="downloadQRCode()" id="download-btn" disabled>
                        <i class="fas fa-download"></i>
                        下载二维码
                    </button>
                    <button type="button" class="btn" onclick="testQRCode()"
                        style="background-color: var(--warning-color); color: white;">
                        <i class="fas fa-bug"></i>
                        测试QR库
                    </button>
                </div>
            </form>
        </div>

        <!-- 预览区域 -->
        <div class="preview-section">
            <h2>
                <i class="fas fa-eye"></i>
                二维码预览
            </h2>
            <div class="qr-container" id="qr-display">
                <div class="qr-placeholder">
                    <i class="fas fa-qrcode"></i>
                    <div>请先填写WiFi信息并点击"生成二维码"</div>
                </div>
            </div>

            <!-- WiFi信息显示 -->
            <div class="wifi-info" id="wifi-info" style="display: none;">
                <div class="wifi-info-item">
                    <span class="wifi-info-label">WiFi名称:</span>
                    <span class="wifi-info-value" id="display-ssid">-</span>
                </div>
                <div class="wifi-info-item">
                    <span class="wifi-info-label">WiFi密码:</span>
                    <span class="wifi-info-value" id="display-password">-</span>
                </div>
                <div class="wifi-info-item">
                    <span class="wifi-info-label">加密类型:</span>
                    <span class="wifi-info-value">WPA/WPA2</span>
                </div>
            </div>
        </div>

        <!-- 使用说明 -->
        <div class="help-section">
            <h2>
                <i class="fas fa-question-circle"></i>
                使用说明
            </h2>
            <p><strong>如何使用生成的二维码：</strong></p>
            <ul>
                <li><strong>iOS设备：</strong>打开相机应用，对准二维码即可自动识别并连接WiFi</li>
                <li><strong>Android设备：</strong>打开相机或扫码应用，扫描二维码后点击连接</li>
                <li><strong>其他设备：</strong>手动输入显示的WiFi名称和密码进行连接</li>
            </ul>
            <p><strong>注意事项：</strong></p>
            <ul>
                <li>生成的二维码包含WiFi连接信息，请妥善保管</li>
                <li>建议定期更换WiFi密码以确保网络安全</li>
                <li>二维码支持WPA/WPA2加密的WiFi网络</li>
                <li>部分老旧设备可能不支持二维码连接WiFi功能</li>
            </ul>
        </div>

        <!-- 隐藏的临时容器 -->
        <div id="qr-temp-container"></div>
    </div>

    <!-- 主题注入器 -->
    <script src="../js/theme-injector.js"></script>

    <script>
        // WiFi QR码生成器主要功能
        class WifiQRGenerator {
            constructor() {
                this.qrCanvas = null;
                this.init();
            }

            init() {
                // 绑定输入事件
                document.getElementById('ssid').addEventListener('input', () => {
                    this.clearQRCode();
                });

                document.getElementById('password').addEventListener('input', () => {
                    this.clearQRCode();
                });

                // 绑定回车键生成二维码
                document.getElementById('wifi-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.generateQRCode();
                });

                // 绑定回车键
                document.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.generateQRCode();
                    }
                });
            }

            // 转义WiFi字符串中的特殊字符
            escapeWifiString(str) {
                const specialChars = ['\\', ';', ',', ':', '"'];
                let result = '';
                for (let i = 0; i < str.length; i++) {
                    const char = str[i];
                    if (specialChars.includes(char)) {
                        result += '\\' + char;
                    } else {
                        result += char;
                    }
                }
                return result;
            }

            // 确保字符串为UTF-8编码（实际上JavaScript字符串本身就是UTF-16，直接使用即可）
            ensureUTF8(str) {
                // JavaScript字符串本身就支持Unicode，包括中文字符
                // 不需要特殊的编码处理，直接返回原字符串
                return str;
            }

            // 生成二维码
            generateQRCode() {
                const ssid = document.getElementById('ssid').value.trim();
                const password = document.getElementById('password').value.trim();

                if (!ssid) {
                    this.showMessage('请输入WiFi名称', 'error');
                    document.getElementById('ssid').focus();
                    return;
                }

                if (!password) {
                    this.showMessage('请输入WiFi密码', 'error');
                    document.getElementById('password').focus();
                    return;
                }

                try {
                    console.log('开始生成二维码...');
                    console.log('SSID:', ssid);
                    console.log('Password:', password);

                    // 生成WiFi配置字符串 - 直接使用原始字符串，QR8bitByte会处理UTF-8编码
                    const encodedSSID = this.escapeWifiString(ssid);
                    const encodedPassword = this.escapeWifiString(password);
                    const wifiString = `WIFI:S:${encodedSSID};T:WPA;P:${encodedPassword};`;

                    console.log('原始SSID:', ssid);
                    console.log('转义后SSID:', encodedSSID);
                    console.log('WiFi字符串:', wifiString);
                    console.log('WiFi字符串长度:', wifiString.length);

                    // 显示UTF-8字节信息
                    const testQR8bit = new QR8bitByte(wifiString);
                    const utf8Bytes = testQR8bit.stringToUTF8Bytes(wifiString);
                    console.log('UTF-8字节长度:', utf8Bytes.length);
                    console.log('UTF-8字节数组前20个:', utf8Bytes.slice(0, 20));

                    // 清空临时容器
                    const tempContainer = document.getElementById('qr-temp-container');
                    tempContainer.innerHTML = '';

                    // 检查 window.qrcode 是否存在
                    if (typeof window.qrcode !== 'function') {
                        console.error('window.qrcode 函数不存在');
                        throw new Error('QR码生成库未加载');
                    }

                    // 直接在显示区域生成二维码
                    console.log('调用 window.qrcode...');
                    const qrDisplay = document.getElementById('qr-display');
                    qrDisplay.innerHTML = '';

                    // 直接在显示区域生成，不使用临时容器
                    window.qrcode(qrDisplay, {
                        text: wifiString,
                        width: 300,
                        height: 300,
                        typeNumber: -1,
                        correctLevel: QRErrorCorrectLevel.L,
                        background: "#ffffff",
                        foreground: "#000000"
                    });

                    // 等待DOM更新
                    setTimeout(() => {
                        // 查找生成的canvas并设置样式
                        this.qrCanvas = qrDisplay.querySelector('canvas');
                        console.log('找到的canvas:', this.qrCanvas);
                        console.log('Canvas尺寸:', this.qrCanvas ? `${this.qrCanvas.width}x${this.qrCanvas.height}` : 'null');

                        if (this.qrCanvas) {
                            // 设置canvas样式
                            this.qrCanvas.style.maxWidth = '100%';
                            this.qrCanvas.style.height = 'auto';
                            this.qrCanvas.style.display = 'block';
                            this.qrCanvas.style.margin = '0 auto';
                            this.qrCanvas.style.border = '2px solid var(--success-color)';
                            this.qrCanvas.style.borderRadius = 'var(--radius-md)';

                            qrDisplay.classList.add('has-qr');

                            console.log('Canvas样式已设置');
                            console.log('Canvas可见性:', window.getComputedStyle(this.qrCanvas).visibility);
                            console.log('Canvas显示:', window.getComputedStyle(this.qrCanvas).display);

                            // 更新WiFi信息显示
                            document.getElementById('display-ssid').textContent = ssid;
                            document.getElementById('display-password').textContent = password;
                            document.getElementById('wifi-info').style.display = 'block';

                            // 启用下载按钮
                            document.getElementById('download-btn').disabled = false;

                            this.showMessage('二维码生成成功！', 'success');
                            console.log('二维码生成成功！');

                            // 额外检查：尝试获取canvas数据URL
                            try {
                                const dataURL = this.qrCanvas.toDataURL();
                                console.log('Canvas数据URL长度:', dataURL.length);
                                if (dataURL.length < 100) {
                                    console.warn('Canvas数据似乎为空');
                                }
                            } catch (e) {
                                console.error('无法获取Canvas数据:', e);
                            }

                        } else {
                            console.error('未找到生成的canvas元素');
                            console.log('显示区域内容:', qrDisplay.innerHTML);
                            throw new Error('无法生成二维码canvas');
                        }
                    }, 300);

                } catch (error) {
                    console.error('生成二维码失败:', error);
                    this.showMessage('生成二维码失败，请检查输入信息: ' + error.message, 'error');
                }
            }

            // 下载二维码
            downloadQRCode() {
                console.log('开始下载二维码...');
                console.log('当前qrCanvas:', this.qrCanvas);

                if (!this.qrCanvas) {
                    console.error('qrCanvas不存在，尝试重新查找...');
                    // 尝试重新查找canvas
                    this.qrCanvas = document.querySelector('#qr-display canvas');
                    if (!this.qrCanvas) {
                        this.showMessage('请先生成二维码', 'error');
                        return;
                    }
                }

                try {
                    console.log('Canvas尺寸:', this.qrCanvas.width, 'x', this.qrCanvas.height);

                    // 获取canvas数据
                    const dataURL = this.qrCanvas.toDataURL('image/png');
                    console.log('数据URL长度:', dataURL.length);

                    if (dataURL.length < 100) {
                        throw new Error('Canvas数据为空');
                    }

                    // 创建下载链接
                    const link = document.createElement('a');
                    const ssid = document.getElementById('ssid').value || 'WiFi';
                    link.download = `${ssid}-二维码.png`;
                    link.href = dataURL;

                    console.log('下载文件名:', link.download);

                    // 触发下载
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    this.showMessage('二维码下载成功！', 'success');
                    console.log('下载成功');
                } catch (error) {
                    console.error('下载失败:', error);
                    this.showMessage('下载失败：' + error.message, 'error');
                }
            }

            // 清除二维码
            clearQRCode() {
                const qrDisplay = document.getElementById('qr-display');
                qrDisplay.innerHTML = `
                    <div class="qr-placeholder">
                        <i class="fas fa-qrcode"></i>
                        <div>请先填写WiFi信息并点击"生成二维码"</div>
                    </div>
                `;
                qrDisplay.classList.remove('has-qr');

                document.getElementById('wifi-info').style.display = 'none';
                document.getElementById('download-btn').disabled = true;
                this.qrCanvas = null;
            }

            // 显示消息
            showMessage(message, type = 'info') {
                // 移除现有消息
                const existingMessage = document.querySelector('.success-message');
                if (existingMessage) {
                    existingMessage.remove();
                }

                // 创建新消息
                const messageEl = document.createElement('div');
                messageEl.className = 'success-message';
                messageEl.textContent = message;

                if (type === 'error') {
                    messageEl.style.backgroundColor = 'var(--error-color)';
                }

                // 添加到按钮组后面
                const buttonGroup = document.querySelector('.button-group');
                buttonGroup.parentNode.appendChild(messageEl);

                // 显示动画
                setTimeout(() => {
                    messageEl.classList.add('show');
                }, 10);

                // 3秒后自动隐藏
                setTimeout(() => {
                    messageEl.classList.remove('show');
                    setTimeout(() => {
                        if (messageEl.parentNode) {
                            messageEl.remove();
                        }
                    }, 300);
                }, 3000);
            }
        }

        // 全局函数，供按钮调用
        let wifiGenerator;

        function generateQRCode() {
            if (wifiGenerator) {
                wifiGenerator.generateQRCode();
            }
        }

        function downloadQRCode() {
            if (wifiGenerator) {
                wifiGenerator.downloadQRCode();
            }
        }

        // 测试QR码库是否正常工作
        function testQRCode() {
            console.log('=== 测试QR码库 ===');
            console.log('QRCode class:', typeof QRCode);
            console.log('QRErrorCorrectLevel:', typeof QRErrorCorrectLevel);
            console.log('window.qrcode function:', typeof window.qrcode);

            if (typeof QRCode === 'undefined') {
                alert('错误：QRCode类未定义');
                return;
            }

            if (typeof QRErrorCorrectLevel === 'undefined') {
                alert('错误：QRErrorCorrectLevel未定义');
                return;
            }

            if (typeof window.qrcode !== 'function') {
                alert('错误：window.qrcode函数未定义');
                return;
            }

            try {
                // 测试生成一个简单的二维码
                const testContainer = document.getElementById('qr-temp-container');
                testContainer.innerHTML = '';

                window.qrcode(testContainer, {
                    text: 'WIFI:S:测试WiFi;T:WPA;P:12345678;',
                    width: 200,
                    height: 200,
                    typeNumber: -1,
                    correctLevel: QRErrorCorrectLevel.L,
                    background: "#ffffff",
                    foreground: "#000000"
                });

                setTimeout(() => {
                    const canvas = testContainer.querySelector('canvas');
                    if (canvas) {
                        alert('测试成功！QR码库工作正常。');
                        console.log('测试成功，生成的canvas:', canvas);
                    } else {
                        alert('测试失败：未生成canvas元素');
                        console.error('测试失败：未找到canvas');
                    }
                }, 100);

            } catch (error) {
                alert('测试失败：' + error.message);
                console.error('测试失败:', error);
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            console.log('页面加载完成，开始初始化...');

            // 检查必要的依赖是否加载
            console.log('QRCode class:', typeof QRCode);
            console.log('QRErrorCorrectLevel:', typeof QRErrorCorrectLevel);
            console.log('window.qrcode function:', typeof window.qrcode);

            wifiGenerator = new WifiQRGenerator();
            console.log('WiFi生成器初始化完成');
        });
    </script>
</body>

</html>