<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全球时间对比</title>
    <link rel="stylesheet" href="../css/theme.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --clock-max-size: 220px;
            --clock-min-size: 130px;
        }

        body {
            height: 100vh;
            padding: clamp(15px, 3vh, 30px) var(--spacing-md);
            background-color: var(--background-primary);
            color: var(--text-primary);
            font-family: var(--font-family);
            line-height: 1.4;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin: 0;
            box-sizing: border-box;
        }

        .container {
            width: 100%;
            max-width: 1100px;
            margin: 0 auto;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            justify-content: flex-start;
        }

        h1 {
            text-align: center;
            color: var(--text-primary);
            margin: 0 0 clamp(10px, 2vh, 25px) 0;
            font-size: clamp(22px, 3.5vh, 30px);
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            flex-shrink: 0;
        }

        h1::before {
            content: "\f0ac";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            color: var(--primary-color);
        }

        .clocks-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: clamp(15px, 4vw, 40px);
            margin-bottom: clamp(15px, 3vh, 30px);
            flex-shrink: 1;
            min-height: 0;
            width: 100%;
        }

        .clock-card {
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: clamp(15px, 3vh, 30px);
            box-shadow: var(--shadow-md);
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 0;
            position: relative;
        }

        .clock-label {
            display: inline-block;
            width: 28px;
            height: 28px;
            line-height: 28px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            font-weight: bold;
            font-size: 14px;
            margin: 0 auto 10px;
            flex-shrink: 0;
        }

        .clock-title {
            font-size: clamp(16px, 2.5vh, 20px);
            font-weight: 700;
            margin-bottom: clamp(8px, 2vh, 18px);
            line-height: 1.2;
            flex-shrink: 0;
        }

        .clock-title .en-title {
            display: block;
            font-size: 0.7em;
            color: var(--text-secondary);
            font-weight: 400;
            margin-top: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .clock-container {
            position: relative;
            width: clamp(var(--clock-min-size), 30vh, var(--clock-max-size));
            height: clamp(var(--clock-min-size), 30vh, var(--clock-max-size));
            margin: 0 auto clamp(12px, 2.5vh, 25px);
            flex-shrink: 1;
            min-height: 0;
        }

        .clock {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: var(--background-primary);
            border: 2px solid var(--border-color);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }

        .marker {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .marker::after {
            content: "";
            position: absolute;
            top: 2%;
            left: 50%;
            width: 1px;
            height: 4%;
            background-color: var(--text-secondary);
            transform: translateX(-50%);
        }

        .marker.hour::after {
            width: 2px;
            height: 8%;
            background-color: var(--text-primary);
        }

        .hand {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform-origin: 50% 100%;
            z-index: 10;
            will-change: transform; /* 性能优化：启用 GPU 加速 */
        }

        .hour-hand {
            width: 6px;
            height: 25%;
            background-color: var(--text-primary);
            border-radius: 6px;
            margin-left: -3px;
        }

        .minute-hand {
            width: 4px;
            height: 38%;
            background-color: var(--text-secondary);
            border-radius: 4px;
            margin-left: -2px;
        }

        .second-hand {
            width: 2px;
            height: 44%;
            background-color: #ef4444;
            border-radius: 2px;
            margin-left: -1px;
            z-index: 11;
        }

        .center-dot {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #ef4444;
            border: 2px solid white;
            border-radius: 50%;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 12;
        }

        .digital-time {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: clamp(24px, 4vh, 32px);
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 4px;
            flex-shrink: 0;
            letter-spacing: -1px;
        }

        .digital-date {
            font-size: clamp(12px, 1.8vh, 14px);
            color: var(--text-secondary);
            margin-bottom: clamp(10px, 2vh, 20px);
            line-height: 1.4;
            flex-shrink: 0;
        }

        .en-date {
            display: block;
            font-size: 0.85em;
            opacity: 0.7;
            margin-top: 2px;
        }

        .timezone-selector select {
            width: 100%;
            max-width: 220px;
            padding: 8px 12px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background: var(--background-primary);
            color: var(--text-primary);
            font-size: 13px;
            font-weight: 500;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 14px;
            cursor: pointer;
        }

        .time-difference {
            width: 100%;
            padding: clamp(12px, 2.5vh, 20px);
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: var(--radius-lg);
            text-align: center;
            color: white;
            box-shadow: var(--shadow-md);
            flex-shrink: 0;
            box-sizing: border-box;
        }

        .time-difference h3 {
            font-size: clamp(14px, 2vh, 16px);
            margin: 0 0 6px 0;
            opacity: 0.9;
            font-weight: 500;
        }

        .time-difference-value {
            font-size: clamp(20px, 3.5vh, 26px);
            font-weight: 800;
        }

        .footer-info {
            margin-top: auto;
            padding-top: 15px;
            text-align: center;
            border-top: 1px solid var(--border-color);
            color: var(--text-tertiary);
            font-size: 11px;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .clocks-grid {
                grid-template-columns: 1fr;
                overflow-y: auto;
                max-height: 60vh;
            }
            body { overflow-y: auto; }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>全球时间对比</h1>

        <div class="clocks-grid">
            <div class="clock-card" id="left-card">
                <div class="clock-label">A</div>
                <h2 class="clock-title" id="left-clock-title">中国 (北京)</h2>
                <div class="clock-container">
                    <div class="clock left-clock">
                        <div class="clock-face" id="left-clock-face"></div>
                        <div class="hand hour-hand"></div>
                        <div class="hand minute-hand"></div>
                        <div class="hand second-hand"></div>
                        <div class="center-dot"></div>
                    </div>
                </div>
                <div class="digital-time" id="left-time">00:00:00</div>
                <div class="digital-date" id="left-date"></div>
                <div class="timezone-selector">
                    <select id="left-timezone-select"></select>
                </div>
            </div>

            <div class="clock-card" id="right-card">
                <div class="clock-label">B</div>
                <h2 class="clock-title" id="right-clock-title">美国 (纽约)</h2>
                <div class="clock-container">
                    <div class="clock right-clock">
                        <div class="clock-face" id="right-clock-face"></div>
                        <div class="hand hour-hand"></div>
                        <div class="hand minute-hand"></div>
                        <div class="hand second-hand"></div>
                        <div class="center-dot"></div>
                    </div>
                </div>
                <div class="digital-time" id="right-time">00:00:00</div>
                <div class="digital-date" id="right-date"></div>
                <div class="timezone-selector">
                    <select id="right-timezone-select"></select>
                </div>
            </div>
        </div>

        <div class="time-difference" id="time-difference">
            <h3><i class="fas fa-clock"></i> 时差对比</h3>
            <div class="time-difference-value" id="time-difference-value">--小时</div>
        </div>

        <div class="footer-info">
            <p>现已支持全球 60+ 时区 • wow17.com</p>
        </div>
    </div>

    <script src="../js/theme.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // 性能优化点：预定义格式化器，避免每秒重复创建
            const formatters = {
                time: (tz) => new Intl.DateTimeFormat('zh-CN', { timeZone: tz, hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' }),
                dateCN: (tz) => new Intl.DateTimeFormat('zh-CN', { timeZone: tz, year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' }),
                dateEN: (tz) => new Intl.DateTimeFormat('en-US', { timeZone: tz, year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' }),
                // 用于指针计算的简单格式化
                raw: (tz) => new Intl.DateTimeFormat('en-US', { timeZone: tz, hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: false })
            };

            const state = {
                left: { tz: 'Asia/Shanghai', fmt: {} },
                right: { tz: 'America/New_York', fmt: {} }
            };

            // 缓存 DOM 引用
            const dom = {
                left: {
                    time: document.getElementById('left-time'),
                    date: document.getElementById('left-date'),
                    title: document.getElementById('left-clock-title'),
                    h: document.querySelector('.left-clock .hour-hand'),
                    m: document.querySelector('.left-clock .minute-hand'),
                    s: document.querySelector('.left-clock .second-hand'),
                    select: document.getElementById('left-timezone-select')
                },
                right: {
                    time: document.getElementById('right-time'),
                    date: document.getElementById('right-date'),
                    title: document.getElementById('right-clock-title'),
                    h: document.querySelector('.right-clock .hour-hand'),
                    m: document.querySelector('.right-clock .minute-hand'),
                    s: document.querySelector('.right-clock .second-hand'),
                    select: document.getElementById('right-timezone-select')
                },
                diff: document.getElementById('time-difference-value')
            };

            const timezoneData = {
                'Asia/Shanghai': { cn: '中国 (北京)', en: 'China (Beijing)', offset: 8 },
                'Asia/Tokyo': { cn: '日本 (东京)', en: 'Japan (Tokyo)', offset: 9 },
                'Asia/Singapore': { cn: '新加坡', en: 'Singapore', offset: 8 },
                'Asia/Seoul': { cn: '韩国 (首尔)', en: 'South Korea (Seoul)', offset: 9 },
                'Asia/Hong_Kong': { cn: '中国 (香港)', en: 'China (Hong Kong)', offset: 8 },
                'Asia/Taipei': { cn: '中国 (台北)', en: 'China (Taipei)', offset: 8 },
                'Asia/Bangkok': { cn: '泰国 (曼谷)', en: 'Thailand (Bangkok)', offset: 7 },
                'Asia/Kuala_Lumpur': { cn: '马来西亚 (吉隆坡)', en: 'Malaysia (Kuala Lumpur)', offset: 8 },
                'Asia/Manila': { cn: '菲律宾 (马尼拉)', en: 'Philippines (Manila)', offset: 8 },
                'Asia/Jakarta': { cn: '印尼 (雅加达)', en: 'Indonesia (Jakarta)', offset: 7 },
                'Asia/Ho_Chi_Minh': { cn: '越南 (胡志明)', en: 'Vietnam (Ho Chi Minh)', offset: 7 },
                'Asia/Kolkata': { cn: '印度 (新德里)', en: 'India (New Delhi)', offset: 5.5 },
                'Asia/Dubai': { cn: '阿联酋 (迪拜)', en: 'UAE (Dubai)', offset: 4 },
                'Asia/Riyadh': { cn: '沙特 (利雅得)', en: 'Saudi Arabia (Riyadh)', offset: 3 },
                'Asia/Jerusalem': { cn: '以色列 (耶路撒冷)', en: 'Israel (Jerusalem)', offset: 3 },
                'Asia/Karachi': { cn: '巴基斯坦 (卡拉奇)', en: 'Pakistan (Karachi)', offset: 5 },
                'Australia/Sydney': { cn: '澳大利亚 (悉尼)', en: 'Australia (Sydney)', offset: 10 },
                'Australia/Melbourne': { cn: '澳大利亚 (墨尔本)', en: 'Australia (Melbourne)', offset: 10 },
                'Australia/Perth': { cn: '澳大利亚 (珀斯)', en: 'Australia (Perth)', offset: 8 },
                'Australia/Brisbane': { cn: '澳大利亚 (布里斯班)', en: 'Australia (Brisbane)', offset: 10 },
                'Pacific/Auckland': { cn: '新西兰 (奥克兰)', en: 'New Zealand (Auckland)', offset: 12 },
                'Pacific/Fiji': { cn: '斐济', en: 'Fiji', offset: 12 },
                'Europe/London': { cn: '英国 (伦敦)', en: 'UK (London)', offset: 1 },
                'Europe/Paris': { cn: '法国 (巴黎)', en: 'France (Paris)', offset: 2 },
                'Europe/Berlin': { cn: '德国 (柏林)', en: 'Germany (Berlin)', offset: 2 },
                'Europe/Rome': { cn: '意大利 (罗马)', en: 'Italy (Rome)', offset: 2 },
                'Europe/Madrid': { cn: '西班牙 (马德里)', en: 'Spain (Madrid)', offset: 2 },
                'Europe/Moscow': { cn: '俄罗斯 (莫斯科)', en: 'Russia (Moscow)', offset: 3 },
                'Europe/Amsterdam': { cn: '荷兰 (阿姆斯特丹)', en: 'Netherlands (Amsterdam)', offset: 2 },
                'Europe/Brussels': { cn: '比利时 (布鲁塞尔)', en: 'Belgium (Brussels)', offset: 2 },
                'Europe/Zurich': { cn: '瑞士 (苏黎世)', en: 'Switzerland (Zurich)', offset: 2 },
                'Europe/Stockholm': { cn: '瑞典 (斯德哥尔摩)', en: 'Sweden (Stockholm)', offset: 2 },
                'Europe/Oslo': { cn: '挪威 (奥斯陆)', en: 'Norway (Oslo)', offset: 2 },
                'Europe/Copenhagen': { cn: '丹麦 (哥本哈根)', en: 'Denmark (Copenhagen)', offset: 2 },
                'Europe/Helsinki': { cn: '芬兰 (赫尔辛基)', en: 'Finland (Helsinki)', offset: 3 },
                'Europe/Athens': { cn: '希腊 (雅典)', en: 'Greece (Athens)', offset: 3 },
                'Europe/Istanbul': { cn: '土耳其 (伊斯坦布尔)', en: 'Turkey (Istanbul)', offset: 3 },
                'Europe/Vienna': { cn: '奥地利 (维也纳)', en: 'Austria (Vienna)', offset: 2 },
                'Europe/Warsaw': { cn: '波兰 (华沙)', en: 'Poland (Warsaw)', offset: 2 },
                'Europe/Prague': { cn: '捷克 (布拉格)', en: 'Czech Republic (Prague)', offset: 2 },
                'Europe/Budapest': { cn: '匈牙利 (布达佩斯)', en: 'Hungary (Budapest)', offset: 2 },
                'America/New_York': { cn: '美国 (纽约)', en: 'USA (New York)', offset: -4 },
                'America/Los_Angeles': { cn: '美国 (洛杉矶)', en: 'USA (Los Angeles)', offset: -7 },
                'America/Chicago': { cn: '美国 (芝加哥)', en: 'USA (Chicago)', offset: -5 },
                'America/Denver': { cn: '美国 (丹佛)', en: 'USA (Denver)', offset: -6 },
                'America/Toronto': { cn: '加拿大 (多伦多)', en: 'Canada (Toronto)', offset: -4 },
                'America/Vancouver': { cn: '加拿大 (温哥华)', en: 'Canada (Vancouver)', offset: -7 },
                'America/Mexico_City': { cn: '墨西哥 (墨西哥城)', en: 'Mexico (Mexico City)', offset: -5 },
                'America/Sao_Paulo': { cn: '巴西 (圣保罗)', en: 'Brazil (Sao Paulo)', offset: -3 },
                'America/Buenos_Aires': { cn: '阿根廷 (布宜诺斯艾利斯)', en: 'Argentina (Buenos Aires)', offset: -3 },
                'America/Santiago': { cn: '智利 (圣地亚哥)', en: 'Chile (Santiago)', offset: -3 },
                'America/Lima': { cn: '秘鲁 (利马)', en: 'Peru (Lima)', offset: -5 },
                'America/Bogota': { cn: '哥伦比亚 (波哥大)', en: 'Colombia (Bogota)', offset: -5 },
                'Africa/Cairo': { cn: '埃及 (开罗)', en: 'Egypt (Cairo)', offset: 2 },
                'Africa/Johannesburg': { cn: '南非 (约翰内斯堡)', en: 'South Africa (Johannesburg)', offset: 2 },
                'Africa/Lagos': { cn: '尼日利亚 (拉各斯)', en: 'Nigeria (Lagos)', offset: 1 },
                'Africa/Nairobi': { cn: '肯尼亚 (内罗毕)', en: 'Kenya (Nairobi)', offset: 3 },
                'Africa/Casablanca': { cn: '摩洛哥 (卡萨布兰卡)', en: 'Morocco (Casablanca)', offset: 1 },
                'Atlantic/Reykjavik': { cn: '冰岛 (雷克雅未克)', en: 'Iceland (Reykjavik)', offset: 0 }
            };

            function initClockFace(faceId) {
                const face = document.getElementById(faceId);
                const fragment = document.createDocumentFragment();
                for (let i = 0; i < 60; i++) {
                    const marker = document.createElement('div');
                    marker.className = 'marker' + (i % 5 === 0 ? ' hour' : '');
                    marker.style.transform = `rotate(${i * 6}deg)`;
                    fragment.appendChild(marker);
                }
                face.appendChild(fragment);
            }

            function updateTzState(side, tz) {
                state[side].tz = tz;
                state[side].fmt = {
                    time: formatters.time(tz),
                    dateCN: formatters.dateCN(tz),
                    dateEN: formatters.dateEN(tz),
                    raw: formatters.raw(tz)
                };
                // 更新标题
                const data = timezoneData[tz];
                dom[side].title.innerHTML = `${data.cn}<span class="en-title">${data.en}</span>`;
                updateDiff();
            }

            function updateDiff() {
                const diff = timezoneData[state.right.tz].offset - timezoneData[state.left.tz].offset;
                const abs = Math.abs(diff);
                dom.diff.textContent = diff === 0 ? "A 与 B 时间相同" : `A 比 B ${diff > 0 ? '早' : '晚'} ${abs} 小时`;
            }

            function tick() {
                const now = new Date();
                ['left', 'right'].forEach(side => {
                    const s = state[side];
                    const d = dom[side];
                    // 性能优化：使用 textContent 代替 innerHTML
                    d.time.textContent = s.fmt.time.format(now);
                    
                    // 日期由于有 span 结构，仍使用 innerHTML，但日期变化频率低，可接受
                    const cnDate = s.fmt.dateCN.format(now);
                    const enDate = s.fmt.dateEN.format(now);
                    d.date.innerHTML = `${cnDate}<span class="en-date">${enDate}</span>`;

                    // 获取数值用于指针
                    const parts = s.fmt.raw.formatToParts(now);
                    const h = parseInt(parts.find(p => p.type === 'hour').value);
                    const m = parseInt(parts.find(p => p.type === 'minute').value);
                    const sec = parseInt(parts.find(p => p.type === 'second').value);

                    d.h.style.transform = `rotate(${(h % 12) * 30 + m * 0.5}deg)`;
                    d.m.style.transform = `rotate(${m * 6}deg)`;
                    d.s.style.transform = `rotate(${sec * 6}deg)`;
                });
            }

            function populateSelectors() {
                const keys = Object.keys(timezoneData);
                const groups = { '亚洲': 'Asia/', '大洋洲': ['Australia/', 'Pacific/'], '欧洲': 'Europe/', '美洲': 'America/', '非洲': ['Africa/', 'Atlantic/'] };
                
                ['left', 'right'].forEach(side => {
                    const select = dom[side].select;
                    Object.entries(groups).forEach(([label, prefix]) => {
                        const group = document.createElement('optgroup');
                        group.label = label;
                        keys.filter(k => Array.isArray(prefix) ? prefix.some(p => k.startsWith(p)) : k.startsWith(prefix))
                            .sort((a, b) => timezoneData[b].offset - timezoneData[a].offset)
                            .forEach(k => {
                                const opt = new Option(timezoneData[k].cn, k);
                                group.appendChild(opt);
                            });
                        select.appendChild(group);
                    });
                    select.value = state[side].tz;
                    select.onchange = (e) => {
                        updateTzState(side, e.target.value);
                        tick();
                    };
                });
            }

            // 初始化
            initClockFace('left-clock-face');
            initClockFace('right-clock-face');
            populateSelectors();
            updateTzState('left', state.left.tz);
            updateTzState('right', state.right.tz);
            
            tick();
            setInterval(tick, 1000);
        });
    </script>
</body>
</html>
