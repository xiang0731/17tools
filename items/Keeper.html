<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é˜²æ¯å±å·¥å…· - 17Tools</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6366f1;
            --primary-hover: #5b5ce6;
            --secondary-color: #f8fafc;
            --accent-color: #10b981;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --background-primary: #ffffff;
            --background-secondary: #f8fafc;
            --background-tertiary: #e5e7eb;
            --border-color: #e5e7eb;
            --shadow-light: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-medium: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
        }

        [data-theme="dark"] {
            --primary-color: #818cf8;
            --primary-hover: #6366f1;
            --secondary-color: #1f2937;
            --accent-color: #34d399;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --background-primary: #111827;
            --background-secondary: #1f2937;
            --background-tertiary: #374151;
            --border-color: #374151;
            --shadow-light: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 1px 2px 0 rgba(0, 0, 0, 0.2);
            --shadow-medium: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }

        /* æ·±è‰²æ¨¡å¼æ»šåŠ¨æ¡æ ·å¼ */
        [data-theme="dark"] ::-webkit-scrollbar-track {
            background: #1f2937;
        }

        [data-theme="dark"] ::-webkit-scrollbar-thumb {
            background: #4b5563;
        }

        [data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }

        [data-theme="dark"] ::-webkit-scrollbar-corner {
            background: #1f2937;
        }

        /* Firefox æ»šåŠ¨æ¡æ ·å¼ */
        [data-theme="dark"] * {
            scrollbar-color: #4b5563 #1f2937;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            scrollbar-width: thin;
            scrollbar-color: var(--border-color) var(--background-secondary);
        }

        body {
            font-family: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--background-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
            line-height: 1.6;
            padding: 20px;
        }

        /* æµ…è‰²æ¨¡å¼æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--background-secondary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        ::-webkit-scrollbar-corner {
            background: var(--background-secondary);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            animation: fadeInUp 0.6s ease-out;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-top: 24px;
            align-items: start;
        }

        .left-column {
            display: flex;
            flex-direction: column;
            gap: 24px;
            height: fit-content;
        }

        .right-column {
            display: flex;
            flex-direction: column;
            gap: 24px;
            height: fit-content;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 32px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .header h1 i {
            font-size: 2.2rem;
        }

        .header p {
            font-size: 1.1rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        .status-card {
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-medium);
            text-align: center;
            transition: all 0.3s ease;
            height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
        }

        .status-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            opacity: 0.6;
        }

        .status-top-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-shrink: 0;
        }

        .status-indicator {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.8rem;
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
            flex-shrink: 0;
        }

        .status-indicator.active {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.4);
        }

        .status-indicator.inactive {
            background: var(--background-tertiary);
            color: var(--text-secondary);
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .status-text {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 16px;
            flex-shrink: 0;
        }

        .status-text.active {
            color: var(--success-color);
        }

        .status-text.inactive {
            color: var(--text-secondary);
        }

        .status-description {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.4;
            max-width: 280px;
            margin: 0 auto;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px 0;
            min-height: 40px;
        }



        .control-panel {
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-medium);
            height: 520px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .control-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-color), var(--primary-color));
            opacity: 0.6;
        }

        .control-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
            flex-shrink: 0;
            margin-top: auto;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 140px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--error-color), #dc2626);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 18px;
            margin-top: 24px;
            flex: 1;
            align-content: start;
            padding-bottom: 10px;
        }

        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 18px;
            background: var(--background-primary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            transition: all 0.3s ease;
            min-height: 60px;
        }

        .setting-item:hover {
            box-shadow: var(--shadow-light);
        }

        .setting-label {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .setting-label i {
            color: var(--primary-color);
            width: 20px;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: var(--border-color);
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: var(--success-color);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active::after {
            transform: translateX(24px);
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group input {
            width: 80px;
            padding: 6px 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--background-primary);
            color: var(--text-primary);
            font-size: 14px;
        }

        .stats-panel {
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 28px;
            box-shadow: var(--shadow-medium);
        }

        .stats-panel {
            position: relative;
            overflow: hidden;
        }

        .stats-panel:first-child {
            height: 350px;
            margin-bottom: 24px;
            display: flex;
            flex-direction: column;
        }

        .stats-panel:first-child::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #10b981, #059669);
            opacity: 0.7;
        }

        .stats-panel:last-child {
            height: 520px;
            display: flex;
            flex-direction: column;
        }

        .stats-panel:last-child::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #f59e0b, #d97706);
            opacity: 0.7;
        }

        .stats-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            color: var(--text-primary);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            flex: 1;
            align-content: start;
            margin-bottom: 10px;
        }

        .stat-item {
            text-align: center;
            padding: 16px 14px;
            background: var(--background-primary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            transition: all 0.3s ease;
            min-height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .stat-item:hover {
            box-shadow: var(--shadow-light);
            transform: translateY(-1px);
        }

        .diagnostic-log-container {
            margin-top: 18px;
            padding: 16px;
            background: var(--background-primary);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .diagnostic-log-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .diagnostic-log-title i {
            color: var(--primary-color);
            margin-right: 6px;
        }

        .diagnostic-log-content {
            flex: 1;
            overflow-y: auto;
            font-size: 11px;
            line-height: 1.4;
            background: var(--background-secondary);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            min-height: 140px;
        }

        /* è¯Šæ–­æ—¥å¿—æ»šåŠ¨æ¡ç‰¹æ®Šæ ·å¼ */
        .diagnostic-log-content::-webkit-scrollbar {
            width: 6px;
        }

        .diagnostic-log-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .diagnostic-log-content::-webkit-scrollbar-thumb {
            background: var(--text-secondary);
            border-radius: 3px;
            opacity: 0.6;
        }

        .diagnostic-log-content::-webkit-scrollbar-thumb:hover {
            background: var(--text-primary);
            opacity: 0.8;
        }

        .stat-value {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 6px;
            line-height: 1.2;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.3;
        }

        .warning-banner {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 1px solid #f59e0b;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        [data-theme="dark"] .warning-banner {
            background: linear-gradient(135deg, #451a03, #78350f);
            border-color: #92400e;
        }

        .warning-banner i {
            color: #f59e0b;
            font-size: 1.2rem;
        }

        .warning-text {
            color: #92400e;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        [data-theme="dark"] .warning-text {
            color: #fbbf24;
        }

        @media (max-width: 768px) {
            body {
                padding: 16px;
            }

            .header h1 {
                font-size: 2rem;
                flex-direction: column;
                gap: 8px;
            }

            .header p {
                font-size: 1rem;
            }

            .main-layout {
                grid-template-columns: 1fr;
                gap: 20px;
                margin-top: 20px;
            }

            .left-column,
            .right-column {
                gap: 20px;
            }

            .status-card,
            .control-panel,
            .stats-panel {
                padding: 24px;
                height: auto !important;
            }

            .status-card {
                min-height: auto;
                padding: 24px;
                height: auto !important;
            }



            .status-top-section {
                flex-shrink: 0;
            }

            .status-indicator {
                width: 70px;
                height: 70px;
                font-size: 2.2rem;
                margin-bottom: 14px;
            }

            .status-text {
                font-size: 1.2rem;
            }

            .control-panel {
                min-height: auto;
                height: auto !important;
            }

            .control-buttons {
                flex-direction: column;
                align-items: center;
                gap: 12px;
            }

            .btn {
                width: 100%;
                max-width: 280px;
                padding: 12px 24px;
            }

            .settings-grid {
                grid-template-columns: 1fr;
                gap: 14px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .stat-item {
                padding: 14px 12px;
                min-height: 60px;
            }

            .stat-value {
                font-size: 1.4rem;
            }

            .stat-label {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 12px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .main-layout {
                gap: 16px;
            }

            .left-column,
            .right-column {
                gap: 16px;
            }

            .status-card,
            .control-panel,
            .stats-panel {
                padding: 20px;
            }

            .status-card,
            .control-panel,
            .stats-panel {
                min-height: auto;
                height: auto !important;
            }



            .stats-grid {
                grid-template-columns: 1fr;
            }

            .settings-grid {
                gap: 12px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>
                <i class="fas fa-shield-alt"></i>
                é˜²æ¯å±å·¥å…·
            </h1>
            <p>ä¿æŒç”µè„‘æ´»è·ƒçŠ¶æ€ï¼Œé˜²æ­¢è‡ªåŠ¨æ¯å±å’ŒçŠ¶æ€å˜ä¸ºç¦»å¼€</p>
        </div>

        <div class="warning-banner">
            <i class="fas fa-exclamation-triangle"></i>
            <div class="warning-text">
                <strong>ä½¿ç”¨æé†’ï¼š</strong>æ­¤å·¥å…·é€šè¿‡æ¨¡æ‹Ÿç”¨æˆ·æ´»åŠ¨æ¥é˜²æ­¢ç”µè„‘ä¼‘çœ ï¼Œè¯·åœ¨ä½¿ç”¨å®Œæ¯•ååŠæ—¶å…³é—­ä»¥èŠ‚çœç”µé‡ã€‚é•¿æœŸä½¿ç”¨å¯èƒ½å½±å“è®¾å¤‡å¯¿å‘½ã€‚
            </div>
        </div>

        <div class="main-layout">
            <!-- å·¦åˆ—ï¼šè¿è¡Œç»Ÿè®¡å’Œç³»ç»Ÿè¯Šæ–­ -->
            <div class="left-column">
                <div class="stats-panel">
                    <div class="stats-title">
                        <i class="fas fa-chart-line"></i>
                        è¿è¡Œç»Ÿè®¡
                    </div>

                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="runTimeValue">00:00:00</div>
                            <div class="stat-label">è¿è¡Œæ—¶é—´</div>
                        </div>

                        <div class="stat-item">
                            <div class="stat-value" id="actionCountValue">0</div>
                            <div class="stat-label">æ¨¡æ‹ŸåŠ¨ä½œæ¬¡æ•°</div>
                        </div>

                        <div class="stat-item">
                            <div class="stat-value" id="lastActionValue">æœªå¯åŠ¨</div>
                            <div class="stat-label">æœ€ååŠ¨ä½œ</div>
                        </div>

                        <div class="stat-item">
                            <div class="stat-value" id="nextActionValue">--</div>
                            <div class="stat-label">ä¸‹æ¬¡åŠ¨ä½œå€’è®¡æ—¶</div>
                        </div>

                        <div class="stat-item">
                            <div class="stat-value" id="timerRemainingValue">--</div>
                            <div class="stat-label">å®šæ—¶å…³é—­å€’è®¡æ—¶</div>
                        </div>
                    </div>
                </div>

                <div class="stats-panel">
                    <div class="stats-title">
                        <i class="fas fa-stethoscope"></i>
                        ç³»ç»Ÿè¯Šæ–­
                    </div>

                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="pageStatusValue">å‰å°</div>
                            <div class="stat-label">é¡µé¢çŠ¶æ€</div>
                        </div>

                        <div class="stat-item">
                            <div class="stat-value" id="wakeLockValue">æœªçŸ¥</div>
                            <div class="stat-label">å”¤é†’é”çŠ¶æ€</div>
                        </div>

                        <div class="stat-item">
                            <div class="stat-value" id="browserValue">æ£€æµ‹ä¸­</div>
                            <div class="stat-label">æµè§ˆå™¨ç±»å‹</div>
                        </div>

                        <div class="stat-item">
                            <div class="stat-value" id="throttleStatusValue">æ£€æµ‹ä¸­</div>
                            <div class="stat-label">èŠ‚æµæ£€æµ‹</div>
                        </div>

                        <div class="stat-item">
                            <div class="stat-value" id="osValue">æ£€æµ‹ä¸­</div>
                            <div class="stat-label">æ“ä½œç³»ç»Ÿ</div>
                        </div>
                    </div>

                    <div class="diagnostic-log-container">
                        <div class="diagnostic-log-title">
                            <i class="fas fa-info-circle"></i>
                            å®æ—¶è¯Šæ–­æ—¥å¿—
                        </div>
                        <div id="diagnosticLog" class="diagnostic-log-content">
                            <div style="color: var(--text-secondary); font-style: italic;">ç­‰å¾…å¯åŠ¨...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³åˆ—ï¼šæ§åˆ¶é¢æ¿å’Œè®¾ç½® -->
            <div class="right-column">
                <div class="status-card">
                    <div class="status-top-section">
                        <div class="status-indicator inactive" id="statusIndicator">
                            <i class="fas fa-moon"></i>
                        </div>
                        <div class="status-text inactive" id="statusText">é˜²æ¯å±å·²å…³é—­</div>
                    </div>
                    <div class="status-description" id="statusDescription">
                        ç‚¹å‡»å¯åŠ¨æŒ‰é’®å¼€å§‹é˜²æ­¢ç”µè„‘æ¯å±
                    </div>



                    <div class="control-buttons">
                        <button class="btn btn-primary" id="startBtn">
                            <i class="fas fa-play"></i>
                            å¯åŠ¨é˜²æ¯å±
                        </button>
                        <button class="btn btn-danger" id="stopBtn" style="display: none;">
                            <i class="fas fa-stop"></i>
                            åœæ­¢é˜²æ¯å±
                        </button>
                    </div>
                </div>

                <div class="control-panel">
                    <div class="stats-title">
                        <i class="fas fa-cog"></i>
                        å·¥å…·è®¾ç½®
                    </div>

                    <div class="settings-grid">
                        <div class="setting-item">
                            <div class="setting-label">
                                <i class="fas fa-mouse-pointer"></i>
                                æ¨¡æ‹Ÿé¼ æ ‡ç§»åŠ¨
                            </div>
                            <div class="toggle-switch active" id="mouseToggle"></div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-label">
                                <i class="fas fa-keyboard"></i>
                                æ¨¡æ‹Ÿé”®ç›˜æ´»åŠ¨
                            </div>
                            <div class="toggle-switch active" id="keyboardToggle"></div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-label">
                                <i class="fas fa-layer-group"></i>
                                åå°å¢å¼ºæ¨¡å¼
                            </div>
                            <div class="toggle-switch active" id="backgroundToggle"></div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-label">
                                <i class="fas fa-lock"></i>
                                Wake Lockæ¨¡å¼
                            </div>
                            <div class="toggle-switch active" id="wakeLockToggle"></div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-label">
                                <i class="fas fa-clock"></i>
                                æ´»åŠ¨é—´éš”
                            </div>
                            <div class="input-group">
                                <input type="number" id="intervalInput" value="30" min="5" max="300">
                                <span>ç§’</span>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-label">
                                <i class="fas fa-volume-up"></i>
                                å£°éŸ³æé†’
                            </div>
                            <div class="toggle-switch" id="soundToggle"></div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-label">
                                <i class="fas fa-clock"></i>
                                å®šæ—¶å…³é—­
                            </div>
                            <div class="input-group">
                                <input type="number" id="timerInput" value="0" min="0" max="99999" placeholder="0=ä¸é™åˆ¶">
                                <span>åˆ†é’Ÿ</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                class AntiIdleTool {
                    constructor() {
                        this.isActive = false;
                        this.interval = null;
                        this.startTime = null;
                        this.actionCount = 0;
                        this.settings = {
                            mouseMove: true,
                            keyboardActivity: true,
                            intervalSeconds: 30,
                            soundEnabled: false,
                            backgroundMode: true, // æ–°å¢ï¼šåå°æ¨¡å¼å¼€å…³
                            wakeLockEnabled: true, // æ–°å¢ï¼šWake Lockæ¨¡å¼å¼€å…³
                            timerMinutes: 0 // æ–°å¢ï¼šå®šæ—¶å…³é—­åˆ†é’Ÿæ•°ï¼Œ0è¡¨ç¤ºä¸é™åˆ¶
                        };
                        this.countdownInterval = null;
                        this.remainingSeconds = 0;
                        this.isBackground = false;
                        this.backgroundInterval = null;
                        this.shutdownTimer = null; // å®šæ—¶å…³é—­å®šæ—¶å™¨
                        this.shutdownTimeRemaining = 0; // å‰©ä½™å…³é—­æ—¶é—´ï¼ˆç§’ï¼‰
                        this.wakeLockState = {
                            isActive: false,
                            lastRequestTime: 0,
                            failureCount: 0,
                            maxFailures: 3,
                            cooldownPeriod: 30000, // 30ç§’å†·å´æœŸ
                            minInterval: 10000 // æœ€å°é—´éš”10ç§’
                        };
                        this.performanceMonitor = {
                            eventCount: 0,
                            errorCount: 0,
                            lastPerformanceCheck: Date.now(),
                            maxEventsPerMinute: 10, // æ¯åˆ†é’Ÿæœ€å¤š10ä¸ªäº‹ä»¶
                            isThrottled: false
                        };
                        this.diagnostics = {
                            browser: this.detectBrowser(),
                            os: this.detectOS(),
                            wakeLockSupported: 'wakeLock' in navigator,
                            throttleTest: { start: Date.now(), count: 0 }
                        };

                        this.init();
                    }

                    init() {
                        this.bindEvents();
                        this.loadSettings();
                        this.updateUI();
                        this.startCountdownTimer();
                        this.initDiagnostics();
                        this.startThrottleTest();
                    }

                    bindEvents() {
                        document.getElementById('startBtn').addEventListener('click', () => this.start());
                        document.getElementById('stopBtn').addEventListener('click', () => this.stop());

                        // è®¾ç½®åˆ‡æ¢äº‹ä»¶
                        document.getElementById('mouseToggle').addEventListener('click', (e) => {
                            this.toggleSetting('mouseMove', e.target);
                        });

                        document.getElementById('keyboardToggle').addEventListener('click', (e) => {
                            this.toggleSetting('keyboardActivity', e.target);
                        });

                        document.getElementById('soundToggle').addEventListener('click', (e) => {
                            this.toggleSetting('soundEnabled', e.target);
                        });

                        document.getElementById('backgroundToggle').addEventListener('click', (e) => {
                            this.toggleSetting('backgroundMode', e.target);
                        });

                        document.getElementById('wakeLockToggle').addEventListener('click', (e) => {
                            this.toggleSetting('wakeLockEnabled', e.target);
                        });

                        document.getElementById('intervalInput').addEventListener('change', (e) => {
                            this.settings.intervalSeconds = parseInt(e.target.value);
                            this.saveSettings();
                            if (this.isActive) {
                                this.restart();
                            }
                        });

                        document.getElementById('timerInput').addEventListener('change', (e) => {
                            this.settings.timerMinutes = parseInt(e.target.value) || 0;
                            this.saveSettings();
                            if (this.isActive) {
                                this.setupShutdownTimer();
                            }
                        });

                        // é¡µé¢çŠ¶æ€å˜åŒ–ç›‘å¬ - å¢å¼ºåå°è¿è¡Œèƒ½åŠ›
                        document.addEventListener('visibilitychange', () => {
                            if (document.hidden) {
                                // é¡µé¢è¿›å…¥åå°ï¼Œåˆ‡æ¢åˆ°åå°æ¨¡å¼
                                this.switchToBackgroundMode();
                            } else {
                                // é¡µé¢é‡æ–°è·å¾—ç„¦ç‚¹ï¼Œåˆ‡æ¢å›å‰å°æ¨¡å¼å¹¶ç«‹å³è·å–Wake Lock
                                this.switchToForegroundMode();
                                if (this.isActive && this.settings.wakeLockEnabled) {
                                    setTimeout(() => this.requestWakeLockThrottled(), 100); // å»¶è¿Ÿ100msç¡®ä¿é¡µé¢å®Œå…¨å¯è§
                                }
                            }
                        });

                        // ç›‘å¬é¡µé¢è·å¾—/å¤±å»ç„¦ç‚¹
                        window.addEventListener('focus', () => {
                            if (this.isActive) {
                                this.switchToForegroundMode();
                            }
                        });

                        window.addEventListener('blur', () => {
                            if (this.isActive) {
                                this.switchToBackgroundMode();
                            }
                        });

                        // é¡µé¢å…³é—­å‰æé†’
                        window.addEventListener('beforeunload', (e) => {
                            if (this.isActive) {
                                e.preventDefault();
                                e.returnValue = 'é˜²æ¯å±å·¥å…·æ­£åœ¨è¿è¡Œï¼Œç¡®å®šè¦å…³é—­é¡µé¢å—ï¼Ÿ';
                                return e.returnValue;
                            }
                        });
                    }

                    toggleSetting(setting, element) {
                        this.settings[setting] = !this.settings[setting];
                        element.classList.toggle('active');
                        this.saveSettings();

                        if (this.settings.soundEnabled && this.settings[setting]) {
                            this.playSound();
                        }
                    }

                    start() {
                        if (this.isActive) return;

                        this.isActive = true;
                        this.startTime = Date.now();
                        this.actionCount = 0;
                        this.remainingSeconds = this.settings.intervalSeconds;

                        // ç«‹å³æ‰§è¡Œä¸€æ¬¡
                        this.performAction();

                        // è®¾ç½®å®šæ—¶å™¨
                        this.interval = setInterval(() => {
                            this.performAction();
                        }, this.settings.intervalSeconds * 1000);

                        this.updateUI();
                        this.startStatsTimer();
                        this.setupShutdownTimer(); // è®¾ç½®å®šæ—¶å…³é—­

                        if (this.settings.soundEnabled) {
                            this.playSound(440, 100); // å¯åŠ¨éŸ³
                        }

                        this.logDiagnostic('âœ… é˜²æ¯å±å·¥å…·å·²å¯åŠ¨');
                    }

                    stop() {
                        if (!this.isActive) return;

                        this.isActive = false;
                        this.isBackground = false;

                        // æ¸…ç†æ‰€æœ‰å®šæ—¶å™¨
                        if (this.interval) {
                            clearInterval(this.interval);
                            this.interval = null;
                        }

                        if (this.statsTimer) {
                            clearInterval(this.statsTimer);
                            this.statsTimer = null;
                        }

                        if (this.backgroundInterval) {
                            clearInterval(this.backgroundInterval);
                            this.backgroundInterval = null;
                        }

                        // æ¸…ç†å®šæ—¶å…³é—­å®šæ—¶å™¨
                        if (this.shutdownTimer) {
                            clearTimeout(this.shutdownTimer);
                            this.shutdownTimer = null;
                        }
                        this.shutdownTimeRemaining = 0;

                        // é‡Šæ”¾å”¤é†’é”
                        if (this.wakeLock) {
                            this.wakeLock.release();
                            this.wakeLock = null;
                        }
                        this.wakeLockState.isActive = false;

                        this.updateUI();

                        if (this.settings.soundEnabled) {
                            this.playSound(220, 100); // åœæ­¢éŸ³
                        }

                        this.logDiagnostic('âœ… é˜²æ¯å±å·¥å…·å·²åœæ­¢');
                    }

                    restart() {
                        if (this.isActive) {
                            this.stop();
                            setTimeout(() => this.start(), 100);
                        }
                    }

                    // åˆ‡æ¢åˆ°åå°æ¨¡å¼
                    switchToBackgroundMode() {
                        if (!this.isActive || this.isBackground || !this.settings.backgroundMode) return;

                        this.isBackground = true;
                        this.logDiagnostic('ğŸ”„ åˆ‡æ¢åˆ°åå°æ¨¡å¼');

                        // æ›´æ–°UIæ˜¾ç¤ºåå°çŠ¶æ€
                        const statusDescription = document.getElementById('statusDescription');
                        if (statusDescription) {
                            statusDescription.textContent = 'åå°æ¨¡å¼è¿è¡Œ - ç®€å•ç­–ç•¥é˜²æ­¢æ¯å±';
                        }

                        // åå°æ¨¡å¼ï¼šæ¯5ç§’æ‰§è¡Œä¸€æ¬¡åŸºæœ¬æ“ä½œ
                        this.backgroundInterval = setInterval(() => {
                            if (!document.hidden && this.settings.wakeLockEnabled) {
                                this.requestWakeLockThrottled();
                            }
                            this.performAction(); // å¤ç”¨ç°æœ‰çš„åŠ¨ä½œæ‰§è¡Œå‡½æ•°
                        }, 5000);

                        this.logDiagnostic('âœ… åå°æ¨¡å¼å·²å¯åŠ¨');
                    }

                    // åˆ‡æ¢åˆ°å‰å°æ¨¡å¼
                    switchToForegroundMode() {
                        if (!this.isActive || !this.isBackground) return;

                        this.isBackground = false;
                        this.logDiagnostic('ğŸ”„ åˆ‡æ¢åˆ°å‰å°æ¨¡å¼');

                        // æ›´æ–°UIæ˜¾ç¤ºå‰å°çŠ¶æ€
                        const statusDescription = document.getElementById('statusDescription');
                        if (statusDescription) {
                            statusDescription.textContent = 'æ­£åœ¨æ¨¡æ‹Ÿç”¨æˆ·æ´»åŠ¨ï¼Œé˜²æ­¢ç”µè„‘ä¼‘çœ ';
                        }

                        // æ¸…ç†åå°å®šæ—¶å™¨
                        if (this.backgroundInterval) {
                            clearInterval(this.backgroundInterval);
                            this.backgroundInterval = null;
                        }

                        this.logDiagnostic('âœ… å‰å°æ¨¡å¼å·²æ¢å¤');
                    }

                    // è®¾ç½®å®šæ—¶å…³é—­
                    setupShutdownTimer() {
                        // æ¸…ç†ç°æœ‰å®šæ—¶å™¨
                        if (this.shutdownTimer) {
                            clearTimeout(this.shutdownTimer);
                            this.shutdownTimer = null;
                        }

                        // å¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™ä¸å¯ç”¨å®šæ—¶å…³é—­
                        if (this.settings.timerMinutes <= 0) {
                            this.shutdownTimeRemaining = 0;
                            document.getElementById('timerRemainingValue').textContent = '--';
                            this.logDiagnostic('ğŸ”„ å®šæ—¶å…³é—­å·²ç¦ç”¨');
                            return;
                        }

                        // è®¾ç½®å‰©ä½™æ—¶é—´ï¼ˆè½¬æ¢ä¸ºç§’ï¼‰
                        this.shutdownTimeRemaining = this.settings.timerMinutes * 60;

                        // è®¾ç½®å®šæ—¶å™¨
                        this.shutdownTimer = setTimeout(() => {
                            this.logDiagnostic('â° å®šæ—¶å…³é—­æ—¶é—´åˆ°ï¼Œè‡ªåŠ¨åœæ­¢é˜²æ¯å±');

                            if (this.settings.soundEnabled) {
                                // æ’­æ”¾ç‰¹æ®Šçš„å…³é—­æç¤ºéŸ³
                                this.playSound(800, 200);
                                setTimeout(() => this.playSound(600, 200), 250);
                                setTimeout(() => this.playSound(400, 300), 500);
                            }

                            this.stop();
                        }, this.shutdownTimeRemaining * 1000);

                        this.logDiagnostic(`â° è®¾ç½®å®šæ—¶å…³é—­ï¼š${this.settings.timerMinutes}åˆ†é’Ÿåè‡ªåŠ¨åœæ­¢`);
                    }

                    // æ›´æ–°å®šæ—¶å…³é—­å€’è®¡æ—¶æ˜¾ç¤º
                    updateShutdownCountdown() {
                        if (this.shutdownTimeRemaining <= 0) {
                            document.getElementById('timerRemainingValue').textContent = '--';
                            return;
                        }

                        this.shutdownTimeRemaining--;

                        const hours = Math.floor(this.shutdownTimeRemaining / 3600);
                        const minutes = Math.floor((this.shutdownTimeRemaining % 3600) / 60);
                        const seconds = this.shutdownTimeRemaining % 60;

                        let timeString = '';
                        if (hours > 0) {
                            timeString = `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        } else {
                            timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                        }

                        document.getElementById('timerRemainingValue').textContent = timeString;

                        // åœ¨æœ€å1åˆ†é’Ÿæ—¶æ”¹å˜é¢œè‰²æé†’
                        const timerElement = document.getElementById('timerRemainingValue');
                        if (this.shutdownTimeRemaining <= 60) {
                            timerElement.style.color = 'var(--error-color)';

                            // æœ€å10ç§’å€’è®¡æ—¶æé†’
                            if (this.shutdownTimeRemaining <= 10 && this.shutdownTimeRemaining > 0) {
                                if (this.settings.soundEnabled) {
                                    this.playSound(1000, 100);
                                }
                                this.logDiagnostic(`âš ï¸ å€’è®¡æ—¶ï¼š${this.shutdownTimeRemaining}ç§’åè‡ªåŠ¨å…³é—­`);
                            }
                        } else if (this.shutdownTimeRemaining <= 300) { // æœ€å5åˆ†é’Ÿå˜æ©™è‰²
                            timerElement.style.color = 'var(--warning-color)';
                        } else {
                            timerElement.style.color = 'var(--primary-color)';
                        }
                    }



                    performAction() {
                        // æ€§èƒ½ç›‘æ§å’Œä¿æŠ¤æœºåˆ¶
                        if (!this.checkPerformanceHealth()) {
                            this.logDiagnostic('âš ï¸ æ€§èƒ½ä¿æŠ¤ï¼šè·³è¿‡æœ¬æ¬¡æ“ä½œ');
                            return;
                        }

                        const actions = [];

                        try {
                            if (this.settings.mouseMove) {
                                actions.push('é¼ æ ‡ç§»åŠ¨');
                                this.simulateMouseMove();
                            }

                            if (this.settings.keyboardActivity) {
                                actions.push('é”®ç›˜æ´»åŠ¨');
                                this.simulateKeyboardActivity();
                            }

                            // è¯·æ±‚ä¿æŒå±å¹•å”¤é†’ï¼ˆä»…åœ¨å¯ç”¨Wake Lockæ¨¡å¼æ—¶ï¼Œä¸”éœ€è¦æ£€æŸ¥é¢‘ç‡é™åˆ¶ï¼‰
                            if (this.settings.wakeLockEnabled) {
                                this.requestWakeLockThrottled();
                            }

                            this.performanceMonitor.eventCount++;

                        } catch (error) {
                            this.performanceMonitor.errorCount++;
                            this.logDiagnostic(`âŒ æ“ä½œæ‰§è¡Œé”™è¯¯: ${error.message}`);

                            // å¦‚æœé”™è¯¯è¿‡å¤šï¼Œæš‚åœæ“ä½œ
                            if (this.performanceMonitor.errorCount > 5) {
                                this.logDiagnostic('âš ï¸ é”™è¯¯è¿‡å¤šï¼Œæš‚åœæ¨¡æ‹Ÿæ“ä½œ');
                                this.settings.mouseMove = false;
                                this.settings.keyboardActivity = false;
                            }
                        }

                        this.actionCount++;
                        this.remainingSeconds = this.settings.intervalSeconds;

                        const actionText = actions.join(' + ');
                        document.getElementById('lastActionValue').textContent = actionText;

                        console.log(`æ‰§è¡Œé˜²æ¯å±åŠ¨ä½œ #${this.actionCount}: ${actionText}`);
                    }

                    simulateMouseMove() {
                        // å¢å¼ºé¼ æ ‡æ¨¡æ‹Ÿï¼Œæé«˜å¯¹Zoomç­‰åº”ç”¨çš„å…¼å®¹æ€§
                        const strategies = [
                            // ç­–ç•¥1ï¼šå¾®å°ç§»åŠ¨ï¼ˆåŸæœ‰ç­–ç•¥ï¼‰
                            () => {
                                const event = new MouseEvent('mousemove', {
                                    clientX: Math.random() * 2,
                                    clientY: Math.random() * 2,
                                    bubbles: true,
                                    cancelable: true,
                                    view: window
                                });
                                document.dispatchEvent(event);
                            },

                            // ç­–ç•¥2ï¼šåœ¨å±å¹•è¾¹ç¼˜è¿›è¡Œå¾®å°ç§»åŠ¨
                            () => {
                                const edge = Math.random() < 0.5 ? 0 : window.innerWidth - 1;
                                const event = new MouseEvent('mousemove', {
                                    clientX: edge + (Math.random() - 0.5) * 2,
                                    clientY: Math.random() * window.innerHeight,
                                    bubbles: true,
                                    cancelable: true,
                                    view: window
                                });
                                document.dispatchEvent(event);
                            },

                            // ç­–ç•¥3ï¼šæ¨¡æ‹Ÿé¼ æ ‡æ‚¬åœ
                            () => {
                                const centerX = window.innerWidth / 2;
                                const centerY = window.innerHeight / 2;
                                const event = new MouseEvent('mousemove', {
                                    clientX: centerX + (Math.random() - 0.5) * 4,
                                    clientY: centerY + (Math.random() - 0.5) * 4,
                                    bubbles: true,
                                    cancelable: true,
                                    view: window
                                });
                                document.dispatchEvent(event);
                            }
                        ];

                        // éšæœºé€‰æ‹©ä¸€ä¸ªç­–ç•¥
                        const strategy = strategies[Math.floor(Math.random() * strategies.length)];
                        strategy();

                        // é¢å¤–è§¦å‘mouseoveräº‹ä»¶ï¼ŒæŸäº›åº”ç”¨å¯èƒ½æ›´å…³æ³¨è¿™ä¸ªäº‹ä»¶
                        const mouseoverEvent = new MouseEvent('mouseover', {
                            clientX: Math.random() * 10,
                            clientY: Math.random() * 10,
                            bubbles: true,
                            cancelable: true,
                            view: window
                        });
                        document.dispatchEvent(mouseoverEvent);

                        // ç§»åŠ¨éšè—å…ƒç´ æ¥è§¦å‘é‡ç»˜ï¼ˆä¿æŒåŸæœ‰åŠŸèƒ½ï¼‰
                        if (!this.hiddenElement) {
                            this.hiddenElement = document.createElement('div');
                            this.hiddenElement.style.position = 'absolute';
                            this.hiddenElement.style.left = '-9999px';
                            this.hiddenElement.style.width = '1px';
                            this.hiddenElement.style.height = '1px';
                            this.hiddenElement.style.pointerEvents = 'none';
                            document.body.appendChild(this.hiddenElement);
                        }

                        this.hiddenElement.style.left = `${-9999 + Math.random() * 2}px`;
                        this.hiddenElement.style.top = `${-9999 + Math.random() * 2}px`;

                        this.logDiagnostic('ğŸ–±ï¸ é¼ æ ‡æ¨¡æ‹Ÿæ´»åŠ¨å®Œæˆ');
                    }

                    simulateKeyboardActivity() {
                        // ä½¿ç”¨å¤šç§é”®ç›˜æ¨¡æ‹Ÿç­–ç•¥ï¼Œæé«˜å¯¹Zoomç­‰åº”ç”¨çš„å…¼å®¹æ€§
                        const strategies = [
                            // ç­–ç•¥1ï¼šF15é”®ï¼ˆåŠŸèƒ½é”®ï¼Œé€šå¸¸ä¸ä¼šè§¦å‘ä»»ä½•åŠŸèƒ½ï¼‰
                            {
                                key: 'F15',
                                code: 'F15',
                                keyCode: 126,
                                which: 126
                            },
                            // ç­–ç•¥2ï¼šScrollLocké”®ï¼ˆå¾ˆå°‘ä½¿ç”¨ï¼Œç›¸å¯¹å®‰å…¨ï¼‰
                            {
                                key: 'ScrollLock',
                                code: 'ScrollLock',
                                keyCode: 145,
                                which: 145
                            },
                            // ç­–ç•¥3ï¼šNumLocké”®ï¼ˆåœ¨æŸäº›æƒ…å†µä¸‹æ›´æœ‰æ•ˆï¼‰
                            {
                                key: 'NumLock',
                                code: 'NumLock',
                                keyCode: 144,
                                which: 144
                            },
                            // ç­–ç•¥4ï¼šCtrlé”®ï¼ˆä¿æŒåŸæœ‰åŠŸèƒ½ï¼‰
                            {
                                key: 'Control',
                                code: 'ControlLeft',
                                ctrlKey: true,
                                keyCode: 17,
                                which: 17
                            }
                        ];

                        // éšæœºé€‰æ‹©ä¸€ä¸ªç­–ç•¥ï¼Œå¢åŠ çœŸå®æ€§
                        const strategy = strategies[Math.floor(Math.random() * strategies.length)];

                        const keydownEvent = new KeyboardEvent('keydown', {
                            ...strategy,
                            bubbles: true,
                            cancelable: true,
                            view: window
                        });

                        const keyupEvent = new KeyboardEvent('keyup', {
                            ...strategy,
                            bubbles: true,
                            cancelable: true,
                            view: window,
                            // å¯¹äºCtrlé”®ï¼Œkeyupæ—¶éœ€è¦è®¾ç½®ä¸ºfalse
                            ctrlKey: strategy.ctrlKey ? false : strategy.ctrlKey
                        });

                        // å…ˆè§¦å‘keydownäº‹ä»¶
                        document.dispatchEvent(keydownEvent);

                        // 50msåè§¦å‘keyupäº‹ä»¶
                        setTimeout(() => {
                            document.dispatchEvent(keyupEvent);
                            this.logDiagnostic(`âŒ¨ï¸ æ¨¡æ‹Ÿ${strategy.key}é”®å®Œæˆ`);
                        }, 50);

                        // é¢å¤–åœ¨document.bodyä¸Šä¹Ÿè§¦å‘äº‹ä»¶ï¼Œæé«˜æ£€æµ‹ç‡
                        document.body.dispatchEvent(keydownEvent.constructor === KeyboardEvent ?
                            new KeyboardEvent('keydown', { ...strategy, bubbles: true }) : keydownEvent);
                    }

                    // èŠ‚æµç‰ˆæœ¬çš„Wake Lockè¯·æ±‚
                    requestWakeLockThrottled() {
                        const now = Date.now();

                        // æ£€æŸ¥æ˜¯å¦åœ¨å†·å´æœŸå†…
                        if (this.wakeLockState.failureCount >= this.wakeLockState.maxFailures) {
                            const timeSinceLastFailure = now - this.wakeLockState.lastRequestTime;
                            if (timeSinceLastFailure < this.wakeLockState.cooldownPeriod) {
                                const remainingCooldown = Math.ceil((this.wakeLockState.cooldownPeriod - timeSinceLastFailure) / 1000);
                                document.getElementById('wakeLockValue').textContent = `å†·å´ä¸­(${remainingCooldown}s)`;
                                return;
                            } else {
                                // å†·å´æœŸç»“æŸï¼Œé‡ç½®å¤±è´¥è®¡æ•°
                                this.wakeLockState.failureCount = 0;
                                this.logDiagnostic('ğŸ”„ Wake Lock å†·å´æœŸç»“æŸï¼Œé‡ç½®å¤±è´¥è®¡æ•°');
                            }
                        }

                        // æ£€æŸ¥æœ€å°é—´éš”
                        const timeSinceLastRequest = now - this.wakeLockState.lastRequestTime;
                        if (timeSinceLastRequest < this.wakeLockState.minInterval) {
                            // å¤ªé¢‘ç¹ï¼Œè·³è¿‡è¿™æ¬¡è¯·æ±‚
                            return;
                        }

                        // å¦‚æœå·²ç»æœ‰æ´»è·ƒçš„Wake Lockï¼Œä¸”ä¸éœ€è¦é‡æ–°è·å–ï¼Œåˆ™è·³è¿‡
                        if (this.wakeLockState.isActive && this.wakeLock) {
                            return;
                        }

                        this.wakeLockState.lastRequestTime = now;
                        this.requestWakeLock();
                    }

                    async requestWakeLock() {
                        try {
                            if (!this.settings.wakeLockEnabled) {
                                document.getElementById('wakeLockValue').textContent = 'å·²ç¦ç”¨';
                                this.wakeLockState.isActive = false;
                                return;
                            }

                            if ('wakeLock' in navigator) {
                                // æ£€æŸ¥é¡µé¢æ˜¯å¦å¯è§ï¼ŒWake Lockåªèƒ½åœ¨å¯è§é¡µé¢ä¸­è·å–
                                if (document.hidden) {
                                    document.getElementById('wakeLockValue').textContent = 'é¡µé¢åå°';
                                    this.logDiagnostic('âš ï¸ é¡µé¢åœ¨åå°ï¼Œæ— æ³•è·å–å”¤é†’é”');
                                    this.wakeLockState.isActive = false;
                                    return;
                                }

                                // åªæœ‰åœ¨æ²¡æœ‰æ´»è·ƒWake Lockæ—¶æ‰é‡Šæ”¾æ—§çš„
                                if (this.wakeLock && !this.wakeLockState.isActive) {
                                    await this.wakeLock.release();
                                    this.wakeLock = null;
                                }

                                // å¦‚æœå·²ç»æœ‰æ´»è·ƒçš„Wake Lockï¼Œä¸éœ€è¦é‡æ–°è·å–
                                if (this.wakeLockState.isActive && this.wakeLock) {
                                    return;
                                }

                                this.wakeLock = await navigator.wakeLock.request('screen');
                                this.wakeLockState.isActive = true;
                                this.wakeLockState.failureCount = 0; // æˆåŠŸåé‡ç½®å¤±è´¥è®¡æ•°
                                document.getElementById('wakeLockValue').textContent = 'å·²æ¿€æ´»';
                                this.logDiagnostic('ğŸ”’ Wake Lock å·²æ¿€æ´»');

                                // ç›‘å¬å”¤é†’é”è¢«é‡Šæ”¾çš„äº‹ä»¶
                                this.wakeLock.addEventListener('release', () => {
                                    this.wakeLockState.isActive = false;
                                    document.getElementById('wakeLockValue').textContent = 'å·²é‡Šæ”¾';
                                    this.logDiagnostic('âš ï¸ Wake Lock è¢«ç³»ç»Ÿé‡Šæ”¾');

                                    // å»¶è¿Ÿé‡æ–°è·å–Wake Lockï¼Œé¿å…ç«‹å³é‡è¯•
                                    if (this.isActive && !document.hidden && this.settings.wakeLockEnabled) {
                                        this.logDiagnostic('ğŸ”„ è®¡åˆ’é‡æ–°è·å–Wake Lock');
                                        setTimeout(() => {
                                            this.requestWakeLockThrottled();
                                        }, 5000); // 5ç§’åé‡è¯•ï¼Œè€Œä¸æ˜¯1ç§’
                                    }
                                });

                            } else {
                                document.getElementById('wakeLockValue').textContent = 'ä¸æ”¯æŒ';
                                this.logDiagnostic('âŒ æµè§ˆå™¨ä¸æ”¯æŒWake Lock API');
                                this.wakeLockState.isActive = false;
                            }
                        } catch (err) {
                            this.wakeLockState.isActive = false;
                            this.wakeLockState.failureCount++;

                            document.getElementById('wakeLockValue').textContent = 'è·å–å¤±è´¥';
                            this.logDiagnostic(`âŒ å”¤é†’é”è·å–å¤±è´¥ (${this.wakeLockState.failureCount}/${this.wakeLockState.maxFailures}): ${err.message}`);

                            // å¦‚æœæ˜¯å› ä¸ºé¡µé¢ä¸å¯è§å¯¼è‡´çš„å¤±è´¥ï¼Œæä¾›è§£å†³å»ºè®®
                            if (err.message.includes('not visible')) {
                                this.logDiagnostic('ğŸ’¡ å»ºè®®ï¼šä¿æŒé¡µé¢åœ¨å‰å°æˆ–åˆ‡æ¢åˆ°Chromeæµè§ˆå™¨');
                            }

                            // è¿ç»­å¤±è´¥è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œè¿›å…¥å†·å´æœŸ
                            if (this.wakeLockState.failureCount >= this.wakeLockState.maxFailures) {
                                this.logDiagnostic(`âš ï¸ Wake Lock è¿ç»­å¤±è´¥${this.wakeLockState.maxFailures}æ¬¡ï¼Œè¿›å…¥${this.wakeLockState.cooldownPeriod / 1000}ç§’å†·å´æœŸ`);
                            }
                        }
                    }

                    playSound(frequency = 800, duration = 200) {
                        if (!this.audioContext) {
                            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        }

                        const oscillator = this.audioContext.createOscillator();
                        const gainNode = this.audioContext.createGain();

                        oscillator.connect(gainNode);
                        gainNode.connect(this.audioContext.destination);

                        oscillator.frequency.value = frequency;
                        oscillator.type = 'sine';

                        gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration / 1000);

                        oscillator.start(this.audioContext.currentTime);
                        oscillator.stop(this.audioContext.currentTime + duration / 1000);
                    }

                    startStatsTimer() {
                        this.statsTimer = setInterval(() => {
                            this.updateStats();
                        }, 1000);
                    }

                    startCountdownTimer() {
                        this.countdownInterval = setInterval(() => {
                            if (this.isActive && this.remainingSeconds > 0) {
                                this.remainingSeconds--;
                                document.getElementById('nextActionValue').textContent = `${this.remainingSeconds}ç§’`;
                            } else if (!this.isActive) {
                                document.getElementById('nextActionValue').textContent = '--';
                            }
                        }, 1000);
                    }

                    updateStats() {
                        if (!this.isActive) return;

                        const runTime = Date.now() - this.startTime;
                        const hours = Math.floor(runTime / 3600000);
                        const minutes = Math.floor((runTime % 3600000) / 60000);
                        const seconds = Math.floor((runTime % 60000) / 1000);

                        document.getElementById('runTimeValue').textContent =
                            `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        document.getElementById('actionCountValue').textContent = this.actionCount;



                        // æ›´æ–°å®šæ—¶å…³é—­å€’è®¡æ—¶
                        this.updateShutdownCountdown();
                    }

                    updateUI() {
                        const statusIndicator = document.getElementById('statusIndicator');
                        const statusText = document.getElementById('statusText');
                        const statusDescription = document.getElementById('statusDescription');
                        const startBtn = document.getElementById('startBtn');
                        const stopBtn = document.getElementById('stopBtn');

                        if (this.isActive) {
                            statusIndicator.className = 'status-indicator active';
                            statusIndicator.innerHTML = '<i class="fas fa-shield-alt"></i>';
                            statusText.className = 'status-text active';
                            statusText.textContent = 'é˜²æ¯å±å·²å¯åŠ¨';
                            statusDescription.textContent = 'æ­£åœ¨æ¨¡æ‹Ÿç”¨æˆ·æ´»åŠ¨ï¼Œé˜²æ­¢ç”µè„‘ä¼‘çœ ';
                            startBtn.style.display = 'none';
                            stopBtn.style.display = 'flex';
                        } else {
                            statusIndicator.className = 'status-indicator inactive';
                            statusIndicator.innerHTML = '<i class="fas fa-moon"></i>';
                            statusText.className = 'status-text inactive';
                            statusText.textContent = 'é˜²æ¯å±å·²å…³é—­';
                            statusDescription.textContent = 'ç‚¹å‡»å¯åŠ¨æŒ‰é’®å¼€å§‹é˜²æ­¢ç”µè„‘æ¯å±';
                            startBtn.style.display = 'flex';
                            stopBtn.style.display = 'none';

                            // é‡ç½®ç»Ÿè®¡
                            document.getElementById('runTimeValue').textContent = '00:00:00';
                            document.getElementById('actionCountValue').textContent = '0';
                            document.getElementById('lastActionValue').textContent = 'æœªå¯åŠ¨';
                            document.getElementById('timerRemainingValue').textContent = '--';
                            document.getElementById('timerRemainingValue').style.color = 'var(--primary-color)';


                        }
                    }

                    saveSettings() {
                        localStorage.setItem('antiIdleSettings', JSON.stringify(this.settings));
                    }

                    loadSettings() {
                        const saved = localStorage.getItem('antiIdleSettings');
                        if (saved) {
                            this.settings = { ...this.settings, ...JSON.parse(saved) };
                        }

                        // åº”ç”¨è®¾ç½®åˆ°UI
                        document.getElementById('intervalInput').value = this.settings.intervalSeconds;
                        document.getElementById('timerInput').value = this.settings.timerMinutes;

                        const toggles = {
                            mouseToggle: this.settings.mouseMove,
                            keyboardToggle: this.settings.keyboardActivity,
                            soundToggle: this.settings.soundEnabled,
                            backgroundToggle: this.settings.backgroundMode,
                            wakeLockToggle: this.settings.wakeLockEnabled
                        };

                        Object.entries(toggles).forEach(([id, active]) => {
                            const element = document.getElementById(id);
                            element.classList.toggle('active', active);
                        });
                    }

                    // æ£€æµ‹æµè§ˆå™¨ç±»å‹
                    detectBrowser() {
                        const ua = navigator.userAgent;
                        if (ua.includes('Chrome') && !ua.includes('Edg')) return 'Chrome';
                        if (ua.includes('Firefox')) return 'Firefox';
                        if (ua.includes('Safari') && !ua.includes('Chrome')) return 'Safari';
                        if (ua.includes('Edg')) return 'Edge';
                        return 'æœªçŸ¥';
                    }

                    // æ£€æµ‹æ“ä½œç³»ç»Ÿ
                    detectOS() {
                        const platform = navigator.platform;
                        const ua = navigator.userAgent;

                        if (platform.includes('Mac') || ua.includes('Mac')) return 'macOS';
                        if (platform.includes('Win') || ua.includes('Windows')) return 'Windows';
                        if (platform.includes('Linux') || ua.includes('Linux')) return 'Linux';
                        if (ua.includes('iPhone') || ua.includes('iPad')) return 'iOS';
                        if (ua.includes('Android')) return 'Android';
                        return 'æœªçŸ¥';
                    }

                    // åˆå§‹åŒ–è¯Šæ–­
                    initDiagnostics() {
                        this.updateDiagnosticDisplay();
                        this.logDiagnostic(`ç³»ç»Ÿåˆå§‹åŒ– - æµè§ˆå™¨: ${this.diagnostics.browser}, ç³»ç»Ÿ: ${this.diagnostics.os}`);
                        this.logDiagnostic(`Wake Lock API æ”¯æŒ: ${this.diagnostics.wakeLockSupported ? 'âœ…' : 'âŒ'}`);

                        // é¡µé¢çŠ¶æ€ç›‘å¬
                        document.addEventListener('visibilitychange', () => {
                            const status = document.hidden ? 'åå°' : 'å‰å°';
                            document.getElementById('pageStatusValue').textContent = status;
                            this.logDiagnostic(`é¡µé¢çŠ¶æ€å˜æ›´: ${status}`);
                        });

                        window.addEventListener('focus', () => {
                            document.getElementById('pageStatusValue').textContent = 'å‰å°(ç„¦ç‚¹)';
                            this.logDiagnostic('é¡µé¢è·å¾—ç„¦ç‚¹');
                        });

                        window.addEventListener('blur', () => {
                            document.getElementById('pageStatusValue').textContent = 'åå°(å¤±ç„¦)';
                            this.logDiagnostic('é¡µé¢å¤±å»ç„¦ç‚¹');
                        });
                    }

                    // å¼€å§‹èŠ‚æµæ£€æµ‹
                    startThrottleTest() {
                        let lastTime = Date.now();
                        let missedCalls = 0;
                        let totalCalls = 0;

                        const testInterval = setInterval(() => {
                            totalCalls++;
                            const now = Date.now();
                            const timeDiff = now - lastTime;

                            if (timeDiff > 1100) { // è¶…è¿‡1.1ç§’è¡¨ç¤ºè¢«èŠ‚æµ
                                missedCalls++;
                            }

                            const throttleRate = ((missedCalls / totalCalls) * 100).toFixed(1);
                            const status = missedCalls > 0 ? `${throttleRate}%èŠ‚æµ` : 'æ­£å¸¸';

                            document.getElementById('throttleStatusValue').textContent = status;

                            if (timeDiff > 1500) {
                                this.logDiagnostic(`âš ï¸ æ£€æµ‹åˆ°ä¸¥é‡èŠ‚æµ - é—´éš”: ${timeDiff}ms`);
                            }

                            lastTime = now;
                        }, 1000);

                        // 30ç§’ååœæ­¢æµ‹è¯•
                        setTimeout(() => {
                            clearInterval(testInterval);
                            this.logDiagnostic('èŠ‚æµæ£€æµ‹å®Œæˆ');
                        }, 30000);
                    }

                    // æ›´æ–°è¯Šæ–­æ˜¾ç¤º
                    updateDiagnosticDisplay() {
                        document.getElementById('browserValue').textContent = this.diagnostics.browser;
                        document.getElementById('osValue').textContent = this.diagnostics.os;
                        document.getElementById('wakeLockValue').textContent = this.diagnostics.wakeLockSupported ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ';
                    }

                    // è®°å½•è¯Šæ–­æ—¥å¿—
                    logDiagnostic(message) {
                        const logElement = document.getElementById('diagnosticLog');
                        const timestamp = new Date().toLocaleTimeString();

                        // åˆ›å»ºæ–°çš„æ—¥å¿—è¡Œå…ƒç´ 
                        const logLine = document.createElement('div');
                        logLine.style.cssText = 'margin-bottom: 2px; padding: 2px 0; border-bottom: 1px solid rgba(156, 163, 175, 0.1);';
                        logLine.innerHTML = `<span style="color: var(--text-secondary); font-size: 11px;">[${timestamp}]</span> <span style="color: var(--text-primary);">${message}</span>`;

                        logElement.appendChild(logLine);
                        logElement.scrollTop = logElement.scrollHeight;

                        // ä¿æŒæœ€è¿‘30æ¡è®°å½•
                        const lines = logElement.children;
                        if (lines.length > 30) {
                            logElement.removeChild(lines[0]);
                        }
                    }

                    // è·å–æµè§ˆå™¨ç‰¹å®šçš„æ€§èƒ½æŒ‡æ ‡
                    getBrowserPerformanceInfo() {
                        const info = {
                            memory: performance.memory ? {
                                used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024),
                                total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024)
                            } : null,
                            connection: navigator.connection ? {
                                effectiveType: navigator.connection.effectiveType,
                                downlink: navigator.connection.downlink
                            } : null
                        };
                        return info;
                    }

                    // æ€§èƒ½å¥åº·æ£€æŸ¥
                    checkPerformanceHealth() {
                        const now = Date.now();
                        const timeSinceLastCheck = now - this.performanceMonitor.lastPerformanceCheck;

                        // æ¯åˆ†é’Ÿé‡ç½®è®¡æ•°å™¨
                        if (timeSinceLastCheck > 60000) {
                            this.performanceMonitor.eventCount = 0;
                            this.performanceMonitor.errorCount = 0;
                            this.performanceMonitor.lastPerformanceCheck = now;
                            this.performanceMonitor.isThrottled = false;
                        }

                        // æ£€æŸ¥äº‹ä»¶é¢‘ç‡æ˜¯å¦è¿‡é«˜
                        if (this.performanceMonitor.eventCount >= this.performanceMonitor.maxEventsPerMinute) {
                            if (!this.performanceMonitor.isThrottled) {
                                this.performanceMonitor.isThrottled = true;
                                this.logDiagnostic('âš ï¸ æ£€æµ‹åˆ°é«˜é¢‘æ“ä½œï¼Œå¯åŠ¨æ€§èƒ½ä¿æŠ¤');
                            }
                            return false;
                        }

                        // æ£€æŸ¥é”™è¯¯ç‡æ˜¯å¦è¿‡é«˜
                        if (this.performanceMonitor.errorCount > 3) {
                            this.logDiagnostic('âš ï¸ é”™è¯¯ç‡è¿‡é«˜ï¼Œæš‚åœæ“ä½œ');
                            return false;
                        }

                        return true;
                    }
                }

                // åˆå§‹åŒ–å·¥å…·
                document.addEventListener('DOMContentLoaded', () => {
                    new AntiIdleTool();
                });

                // åº”ç”¨ä¸»é¢˜ï¼ˆä¸ä¸»é¡µé¢ä¿æŒä¸€è‡´ï¼‰
                function applyTheme() {
                    const parentTheme = window.parent?.document?.documentElement?.getAttribute('data-theme');
                    if (parentTheme) {
                        document.documentElement.setAttribute('data-theme', parentTheme);
                    }
                }

                // ç›‘å¬ä¸»é¢˜å˜åŒ–
                const observer = new MutationObserver(() => {
                    applyTheme();
                });

                if (window.parent?.document?.documentElement) {
                    observer.observe(window.parent.document.documentElement, {
                        attributes: true,
                        attributeFilter: ['data-theme']
                    });
                }

                applyTheme();
            </script>
</body>

</html>